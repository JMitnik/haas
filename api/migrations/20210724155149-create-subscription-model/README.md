# Migration `20210724155149-create-subscription-model`

This migration has been generated by Jonathan at 7/24/2021, 5:51:49 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."LanguageEnum" AS ENUM ('DUTCH', 'GERMAN', 'ENGLISH')

CREATE TABLE "public"."ColourSettings" (
"dark" text   ,
"darkest" text   ,
"error" text   ,
"id" SERIAL,
"light" text   ,
"lightest" text   ,
"muted" text   ,
"normal" text   ,
"primary" text   NOT NULL ,
"primaryAlt" text   ,
"secondary" text   ,
"success" text   ,
"tertiary" text   ,
"text" text   ,
"warning" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FontSettings" (
"body" text   ,
"fontTitle" text   ,
"id" SERIAL,
"settingTitle" text   ,
"special" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CustomerSettings" (
"id" SERIAL,
"logoUrl" text   ,
"logoOpacity" integer   DEFAULT 30,
"colourSettingsId" integer   ,
"fontSettingsId" integer   ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Customer" (
"id" text   NOT NULL ,
"slug" text   NOT NULL ,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Tag" (
"id" text   NOT NULL ,
"type" "TagEnum"  NOT NULL DEFAULT E'DEFAULT',
"name" text   NOT NULL ,
"customerId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PostLeafNode" (
"id" text   NOT NULL ,
"header" text   NOT NULL ,
"subtext" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Dialogue" (
"id" text   NOT NULL ,
"title" text   NOT NULL ,
"slug" text   NOT NULL ,
"description" text   NOT NULL ,
"creationDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"publicTitle" text   ,
"customerId" text   NOT NULL ,
"postLeafNodeId" text   ,
"language" "LanguageEnum"  NOT NULL DEFAULT E'ENGLISH',
"isOnline" boolean   NOT NULL DEFAULT false,
"isWithoutGenData" boolean   NOT NULL DEFAULT false,
"endScreenText" text   ,
"wasGeneratedWithGenData" boolean   NOT NULL DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeField" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"placeholder" text   ,
"type" "FormNodeFieldType"  NOT NULL DEFAULT E'shortText',
"isRequired" boolean   NOT NULL DEFAULT false,
"position" integer   NOT NULL ,
"formNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNode" (
"id" text   NOT NULL ,
"helperText" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeFieldEntryData" (
"id" SERIAL,
"email" text   ,
"phoneNumber" text   ,
"url" text   ,
"shortText" text   ,
"longText" text   ,
"number" integer   ,
"relatedFieldId" text   NOT NULL ,
"formNodeEntryId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeEntry" (
"id" SERIAL,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNodeRange" (
"id" text   NOT NULL ,
"start" Decimal(65,30)   ,
"end" Decimal(65,30)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNodeMarker" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"subLabel" text   NOT NULL ,
"sliderNodeId" text   NOT NULL ,
"sliderNodeRangeId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNode" (
"id" text   NOT NULL ,
"unhappyText" text   ,
"happyText" text   ,
"earlyReleaseText" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."VideoEmbeddedNode" (
"id" text   NOT NULL ,
"videoUrl" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionNode" (
"id" text   NOT NULL ,
"creationDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"isLeaf" boolean   NOT NULL DEFAULT false,
"isRoot" boolean   NOT NULL DEFAULT false,
"title" text   NOT NULL ,
"type" "NodeType"  NOT NULL DEFAULT E'GENERIC',
"overrideLeafId" text   ,
"questionDialogueId" text   ,
"edgeId" text   ,
"videoEmbeddedNodeId" text   ,
"sliderNodeId" text   ,
"formNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Share" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"url" text   NOT NULL ,
"title" text   NOT NULL ,
"tooltip" text   ,
"questionNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Link" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"title" text   ,
"type" "LinkTypeEnum"  NOT NULL ,
"url" text   NOT NULL ,
"iconUrl" text   ,
"backgroundColor" text   ,
"questionNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Edge" (
"childNodeId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"id" text   NOT NULL ,
"parentNodeId" text   NOT NULL ,
"dialogueId" text   ,
"questionNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionCondition" (
"conditionType" text   NOT NULL ,
"id" SERIAL,
"matchValue" text   ,
"renderMax" integer   ,
"renderMin" integer   ,
"edgeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionOption" (
"id" SERIAL,
"publicValue" text   ,
"value" text   NOT NULL ,
"overrideLeafId" text   ,
"questionId" text   ,
"questionNodeId" text   ,
"position" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Session" (
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" text   NOT NULL ,
"dialogueId" text   NOT NULL ,
"deliveryId" text   ,
"originUrl" text   ,
"totalTimeInSec" integer   ,
"device" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."NodeEntry" (
"id" text   NOT NULL ,
"creationDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"depth" integer   ,
"relatedEdgeId" text   ,
"relatedNodeId" text   ,
"sessionId" text   ,
"inputSource" "InputSource"  NOT NULL DEFAULT E'CLIENT',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."LinkNodeEntry" (
"id" SERIAL,
"value" jsonb   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNodeEntry" (
"id" SERIAL,
"value" integer   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ChoiceNodeEntry" (
"id" SERIAL,
"value" text   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TextboxNodeEntry" (
"id" SERIAL,
"value" text   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RegistrationNodeEntry" (
"id" SERIAL,
"value" jsonb   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Permission" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Role" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"type" "RoleTypeEnum"  NOT NULL DEFAULT E'USER',
"isPrivate" boolean   NOT NULL DEFAULT false,
"permissions" "SystemPermissionEnum"[]  ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"email" text   NOT NULL ,
"password" text   ,
"phone" text   ,
"firstName" text   ,
"lastName" text   ,
"globalPermissions" "SystemPermissionEnum"[]  ,
"loginToken" text   ,
"loginTokenExpiry" timestamp(3)   ,
"refreshToken" text   ,
"refreshTokenExpiry" timestamp(3)   ,
"lastActivity" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserOfCustomer" (
"userId" text   NOT NULL ,
"customerId" text   NOT NULL ,
"roleId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","customerId")
)

CREATE TABLE "public"."TriggerCondition" (
"id" SERIAL,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"type" "TriggerConditionEnum"  NOT NULL DEFAULT E'LOW_THRESHOLD',
"minValue" integer   ,
"maxValue" integer   ,
"textValue" text   ,
"triggerId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Trigger" (
"id" text   NOT NULL ,
"lastSent" timestamp(3)   ,
"name" text   NOT NULL ,
"type" "TriggerEnum"  NOT NULL DEFAULT E'QUESTION',
"medium" "TriggerMedium"  NOT NULL ,
"relatedNodeId" text   ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionOfTrigger" (
"questionId" text   NOT NULL ,
"triggerId" text   NOT NULL ,
"triggerConditionId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("questionId","triggerId")
)

CREATE TABLE "public"."Job" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"type" "JobType"  NOT NULL ,
"createWorkspaceJobId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."JobProcessLocation" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"path" text   NOT NULL ,
"xMaterialDimension" integer   NOT NULL DEFAULT 0,
"yMaterialDimension" integer   NOT NULL DEFAULT 0,
"type" "JobProcessLocationType"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CustomField" (
"id" text   NOT NULL ,
"key" text   NOT NULL ,
"value" text   NOT NULL ,
"jobProcessLocationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CreateWorkspaceJob" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"name" text   ,
"referenceId" text   ,
"message" text   ,
"errorMessage" text   ,
"referenceType" "CloudReferenceType"  NOT NULL ,
"status" "JobStatusType"  NOT NULL DEFAULT E'PENDING',
"resourcesUrl" text   ,
"requiresRembg" boolean   NOT NULL DEFAULT true,
"requiresScreenshot" boolean   NOT NULL DEFAULT true,
"requiresColorExtraction" boolean   NOT NULL DEFAULT true,
"jobProcessLocationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Campaign" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"workspaceId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CampaignVariantToCampaign" (
"campaignId" text   NOT NULL ,
"campaignVariantId" text   NOT NULL ,
"weight" integer   NOT NULL ,
PRIMARY KEY ("campaignId","campaignVariantId")
)

CREATE TABLE "public"."CampaignVariant" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"body" text   NOT NULL ,
"subject" text   ,
"type" "CampaignVariantTypeEnum"  NOT NULL ,
"customerId" text   NOT NULL ,
"dialogueId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Delivery" (
"id" text   NOT NULL ,
"deliveryRecipientFirstName" text   ,
"deliveryRecipientLastName" text   ,
"deliveryRecipientEmail" text   ,
"deliveryRecipientPhone" text   ,
"campaignId" text   NOT NULL ,
"campaignVariantId" text   NOT NULL ,
"currentStatus" "DeliveryStatusTypeEnum"  NOT NULL ,
"subscriptionId" text   ,
"scheduledAt" timestamp(3)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."DeliveryEvents" (
"id" text   NOT NULL ,
"status" "DeliveryStatusTypeEnum"  NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deliveryId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ConsumerSubscription" (
"id" text   NOT NULL ,
"consumerId" text   NOT NULL ,
"isDisabled" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Consumer" (
"id" text   NOT NULL ,
"firstName" text   ,
"lastName" text   ,
"email" text   ,
"phoneNumber" text   ,
"externalId" text   ,
"externalSource" text   ,
"isDisabled" boolean   NOT NULL DEFAULT false,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_DialogueToTag" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_TriggerToUser" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "CustomerSettings.customerId_unique" ON "public"."CustomerSettings"("customerId")

CREATE UNIQUE INDEX "CustomerSettings_colourSettingsId_unique" ON "public"."CustomerSettings"("colourSettingsId")

CREATE UNIQUE INDEX "CustomerSettings_fontSettingsId_unique" ON "public"."CustomerSettings"("fontSettingsId")

CREATE UNIQUE INDEX "Customer.slug_unique" ON "public"."Customer"("slug")

CREATE UNIQUE INDEX "Dialogue.slug_customerId_unique" ON "public"."Dialogue"("slug", "customerId")

CREATE UNIQUE INDEX "Dialogue_postLeafNodeId_unique" ON "public"."Dialogue"("postLeafNodeId")

CREATE UNIQUE INDEX "FormNodeEntry_nodeEntryId_unique" ON "public"."FormNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "Share_questionNodeId_unique" ON "public"."Share"("questionNodeId")

CREATE UNIQUE INDEX "LinkNodeEntry_nodeEntryId_unique" ON "public"."LinkNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "SliderNodeEntry_nodeEntryId_unique" ON "public"."SliderNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "ChoiceNodeEntry_nodeEntryId_unique" ON "public"."ChoiceNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "TextboxNodeEntry_nodeEntryId_unique" ON "public"."TextboxNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "RegistrationNodeEntry_nodeEntryId_unique" ON "public"."RegistrationNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "Role.id_name_unique" ON "public"."Role"("id", "name")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Job_createWorkspaceJobId_unique" ON "public"."Job"("createWorkspaceJobId")

CREATE UNIQUE INDEX "_DialogueToTag_AB_unique" ON "public"."_DialogueToTag"("A", "B")

CREATE INDEX "_DialogueToTag_B_index" ON "public"."_DialogueToTag"("B")

CREATE UNIQUE INDEX "_TriggerToUser_AB_unique" ON "public"."_TriggerToUser"("A", "B")

CREATE INDEX "_TriggerToUser_B_index" ON "public"."_TriggerToUser"("B")

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("colourSettingsId")REFERENCES "public"."ColourSettings"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("fontSettingsId")REFERENCES "public"."FontSettings"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Dialogue" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Dialogue" ADD FOREIGN KEY ("postLeafNodeId")REFERENCES "public"."PostLeafNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeField" ADD FOREIGN KEY ("formNodeId")REFERENCES "public"."FormNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeFieldEntryData" ADD FOREIGN KEY ("relatedFieldId")REFERENCES "public"."FormNodeField"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeFieldEntryData" ADD FOREIGN KEY ("formNodeEntryId")REFERENCES "public"."FormNodeEntry"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SliderNodeMarker" ADD FOREIGN KEY ("sliderNodeRangeId")REFERENCES "public"."SliderNodeRange"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SliderNodeMarker" ADD FOREIGN KEY ("sliderNodeId")REFERENCES "public"."SliderNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("overrideLeafId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("questionDialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("edgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("videoEmbeddedNodeId")REFERENCES "public"."VideoEmbeddedNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("sliderNodeId")REFERENCES "public"."SliderNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("formNodeId")REFERENCES "public"."FormNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Share" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Link" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("childNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("parentNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionCondition" ADD FOREIGN KEY ("edgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("overrideLeafId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("questionId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("deliveryId")REFERENCES "public"."Delivery"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("sessionId")REFERENCES "public"."Session"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("relatedNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("relatedEdgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."LinkNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SliderNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ChoiceNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TextboxNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RegistrationNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Permission" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Role" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."UserOfCustomer" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOfCustomer" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOfCustomer" ADD FOREIGN KEY ("roleId")REFERENCES "public"."Role"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TriggerCondition" ADD FOREIGN KEY ("triggerId")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Trigger" ADD FOREIGN KEY ("relatedNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Trigger" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOfTrigger" ADD FOREIGN KEY ("questionId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOfTrigger" ADD FOREIGN KEY ("triggerId")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOfTrigger" ADD FOREIGN KEY ("triggerConditionId")REFERENCES "public"."TriggerCondition"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("createWorkspaceJobId")REFERENCES "public"."CreateWorkspaceJob"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CustomField" ADD FOREIGN KEY ("jobProcessLocationId")REFERENCES "public"."JobProcessLocation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CreateWorkspaceJob" ADD FOREIGN KEY ("jobProcessLocationId")REFERENCES "public"."JobProcessLocation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Campaign" ADD FOREIGN KEY ("workspaceId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariantToCampaign" ADD FOREIGN KEY ("campaignId")REFERENCES "public"."Campaign"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariantToCampaign" ADD FOREIGN KEY ("campaignVariantId")REFERENCES "public"."CampaignVariant"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariant" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariant" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Delivery" ADD FOREIGN KEY ("campaignId")REFERENCES "public"."Campaign"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Delivery" ADD FOREIGN KEY ("campaignVariantId")REFERENCES "public"."CampaignVariant"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Delivery" ADD FOREIGN KEY ("subscriptionId")REFERENCES "public"."ConsumerSubscription"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."DeliveryEvents" ADD FOREIGN KEY ("deliveryId")REFERENCES "public"."Delivery"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ConsumerSubscription" ADD FOREIGN KEY ("consumerId")REFERENCES "public"."Consumer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_DialogueToTag" ADD FOREIGN KEY ("A")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_DialogueToTag" ADD FOREIGN KEY ("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TriggerToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TriggerToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210709104828-dashboard---add-optional-placeholder-field-to-form-node-field..20210724155149-create-subscription-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -728,8 +728,12 @@
   currentStatus DeliveryStatusTypeEnum
   events DeliveryEvents[]
+  // Connection to subscription
+  subscriptionId  String?
+  subscription  ConsumerSubscription? @relation(fields: [subscriptionId], references: [id])
+
   scheduledAt DateTime
   createdAt   DateTime  @default(now())
   updatedAt   DateTime? @updatedAt
   Session     Session[]
@@ -741,4 +745,43 @@
   createdAt  DateTime               @default(now())
   deliveryId String?
   Delivery   Delivery?              @relation(fields: [deliveryId], references: [id])
 }
+
+model ConsumerSubscription {
+  id  String @id @default(cuid())
+
+  consumerId  String
+  consumer  Consumer @relation(fields: [consumerId], references: [id])
+
+  // State related properties
+  isDisabled  String?
+
+  // Context connections
+  deliveries  Delivery[]
+
+
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+}
+
+model Consumer {
+  id  String  @id @default(cuid())
+
+  // For basic data
+  firstName String?
+  lastName String?
+  email     String?
+  phoneNumber   String?
+
+  // For properties related to external connections
+  externalId  String?
+  externalSource  String?
+
+  // State related properties
+  isDisabled  Boolean @default(false)
+
+  subscriptions ConsumerSubscription[]
+
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+}
```


