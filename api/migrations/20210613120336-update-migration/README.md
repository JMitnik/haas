# Migration `20210613120336-update-migration`

This migration has been generated by Jonathan at 6/13/2021, 2:03:36 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."CampaignVariantEdge" ADD COLUMN "directCampaignId" text   NOT NULL 

ALTER TABLE "public"."CampaignVariantEdge" ADD FOREIGN KEY ("directCampaignId")REFERENCES "public"."Campaign"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210612225939-add-schedule-metrics..20210613120336-update-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -668,8 +668,11 @@
 model Campaign {
   id            String                      @id @default(cuid())
   label         String
   deliveries    Delivery[]
+  directVariantEdges CampaignVariantEdge[] @relation("DirectVariantEdges")
+
+  // DEPRECATED
   variantsEdges CampaignVariantToCampaign[] // TODO: Rename to directVariantEdges
   nestedVariantEdges CampaignVariantEdge[]
   variants      CampaignVariant[] @relation
@@ -689,8 +692,9 @@
   campaignVariantId String
   campaignVariant   CampaignVariant @relation(fields: [campaignVariantId], references: [id])
   // Weight decides in A/B testing which
+  // DEPRECATED
   weight Int
   @@id([campaignId, campaignVariantId])
 }
@@ -751,8 +755,10 @@
 model CampaignVariantEdgeCondition {
   id String @id @default(cuid())
   campaignVariantEdgeId String @unique
   campaignVariantEdge CampaignVariantEdge @relation(fields: [campaignVariantEdgeId], references: [id])
+
+  // Conditions
   AB__Weight Int?
 }
 model CampaignVariantEdge {
@@ -760,8 +766,11 @@
   campaignId  String
   campaign    Campaign  @relation(fields: [campaignId], references: [id])
+  directCampaignId String
+  directCampaign  Campaign @relation("DirectVariantEdges", fields: [directCampaignId], references: [id])
+
   // A next campaign variant might be triggered based on if this edge has a certain condition
   condition CampaignVariantEdgeConditionEnum?
   conditionValue  CampaignVariantEdgeCondition?
```


