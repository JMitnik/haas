# Migration `20210508191616-create-topic`

This migration has been generated by Jonathan at 5/8/2021, 9:16:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."QuestionNode" ADD COLUMN "relatedTopicId" text   

ALTER TABLE "public"."QuestionOption" ADD COLUMN "relatedTopicValueId" text   

CREATE TABLE "public"."Topic" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TopicValue" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"parentTopicId" text   NOT NULL ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."TopicValue" ADD FOREIGN KEY ("parentTopicId")REFERENCES "public"."Topic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("relatedTopicId")REFERENCES "public"."Topic"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("relatedTopicValueId")REFERENCES "public"."TopicValue"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210420044138-add-material-dimension-fields-to-job-process-location..20210508191616-create-topic
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -192,8 +192,9 @@
   earlyReleaseText String?
 }
+// This is the same as a Question
 model QuestionNode {
   id           String           @id @default(cuid())
   creationDate DateTime         @default(now())
   updatedAt    DateTime         @updatedAt
@@ -210,9 +211,8 @@
   questionDialogue   Dialogue? @relation(fields: [questionDialogueId], references: [id])
   questionDialogueId String?
-
   isChildNodeOf              Edge[]      @relation("Edge_childNodeToQuestionNode")
   isParentNodeOf             Edge[]      @relation("Edge_parentNodeToQuestionNode")
   isRelatedNodeOfNodeEntries NodeEntry[]
@@ -231,8 +231,11 @@
   links             Link[]
   QuestionOfTrigger QuestionOfTrigger[]
   sliderNodeId      String?
   formNodeId        String?
+
+  relatedTopicId  String?
+  relatedTopic  Topic? @relation(fields: [relatedTopicId], references: [id])
 }
 enum LinkTypeEnum {
   SOCIAL
@@ -309,10 +312,30 @@
   question   QuestionNode? @relation("QuestionNodeOptions", fields: [questionId], references: [id])
   questionNodeId String?
   QuestionNode   QuestionNode? @relation(fields: [questionNodeId], references: [id])
+
+  relatedTopicValueId String?
+  relatedTopicValue TopicValue? @relation(fields: [relatedTopicValueId], references: [id])
 }
+model Topic {
+  id  String  @id @default(cuid())
+  label String
+  values  TopicValue[]
+
+  relatedQuestions  QuestionNode[]
+}
+
+model TopicValue {
+  id  String  @id @default(cuid())
+  label String
+
+  parentTopicId String
+  parentTopic Topic @relation(fields: [parentTopicId], references: [id])
+  relatedChoices  QuestionOption[]
+}
+
 model Session {
   createdAt   DateTime    @default(now())
   id          String      @id @default(cuid())
   dialogueId  String
```


