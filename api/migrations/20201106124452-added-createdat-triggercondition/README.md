# Migration `20201106124452-added-createdat-triggercondition`

This migration has been generated by Cold-A-Muse at 11/6/2020, 1:44:52 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."TriggerCondition" ADD COLUMN "createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201102235202-add-property..20201106124452-added-createdat-triggercondition
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -13,9 +13,9 @@
 model ColourSettings {
   dark             String?
   darkest          String?
   error            String?
-  id               Int               @default(autoincrement()) @id
+  id               Int               @id @default(autoincrement())
   light            String?
   lightest         String?
   muted            String?
   normal           String?
@@ -31,16 +31,16 @@
 model FontSettings {
   body             String?
   fontTitle        String?
-  id               Int               @default(autoincrement()) @id
+  id               Int               @id @default(autoincrement())
   settingTitle     String?
   special          String?
   customerSettings CustomerSettings?
 }
 model CustomerSettings {
-  id               Int             @default(autoincrement()) @id
+  id               Int             @id @default(autoincrement())
   logoUrl          String?
   colourSettingsId Int?
   colourSettings   ColourSettings? @relation(fields: [colourSettingsId], references: [id])
   fontSettingsId   Int?
@@ -49,9 +49,9 @@
   customer         Customer?       @relation(fields: [customerId], references: [id])
 }
 model Customer {
-  id          String            @default(cuid()) @id
+  id          String            @id @default(cuid())
   slug        String            @unique
   name        String
   settings    CustomerSettings?
   dialogues   Dialogue[]
@@ -68,33 +68,33 @@
   LOCATION
 }
 model Tag {
-  id         String     @default(cuid()) @id
+  id         String     @id @default(cuid())
   type       TagEnum    @default(value: DEFAULT)
   name       String
   isTagOf    Dialogue[] @relation(references: [id])
   customer   Customer   @relation(fields: [customerId], references: [id])
   customerId String
 }
 model Dialogue {
-  id           String         @default(cuid()) @id
-  title        String
-  slug         String
-  description  String
-  creationDate DateTime       @default(now())
-  updatedAt    DateTime?      @updatedAt
-  publicTitle  String?
-  customerId   String
-  customer     Customer       @relation(fields: [customerId], references: [id])
-  edges        Edge[]
-  questions    QuestionNode[]
-  sessions     Session[]
-  tags         Tag[]
-  isOnline     Boolean        @default(value: false)
-  isWithoutGenData Boolean @default(value: false)
-  
+  id               String         @id @default(cuid())
+  title            String
+  slug             String
+  description      String
+  creationDate     DateTime       @default(now())
+  updatedAt        DateTime?      @updatedAt
+  publicTitle      String?
+  customerId       String
+  customer         Customer       @relation(fields: [customerId], references: [id])
+  edges            Edge[]
+  questions        QuestionNode[]
+  sessions         Session[]
+  tags             Tag[]
+  isOnline         Boolean        @default(value: false)
+  isWithoutGenData Boolean        @default(value: false)
+
   wasGeneratedWithGenData Boolean @default(value: false)
   @@unique([slug, customerId])
 }
@@ -108,9 +108,9 @@
   SHARE
 }
 model QuestionNode {
-  id           String           @default(cuid()) @id
+  id           String           @id @default(cuid())
   creationDate DateTime         @default(now())
   updatedAt    DateTime         @updatedAt
   isLeaf       Boolean          @default(false)
   isRoot       Boolean          @default(false)
@@ -137,9 +137,10 @@
   triggers       Trigger[]
   share Share?
-  links Link[]
+  links             Link[]
+  QuestionOfTrigger QuestionOfTrigger[]
 }
 enum LinkTypeEnum {
   SOCIAL
@@ -151,9 +152,9 @@
   TWITTER
 }
 model Share {
-  id        String   @default(cuid()) @id
+  id        String    @id @default(cuid())
   createdAt DateTime? @default(now())
   updatedAt DateTime? @updatedAt
   url     String
@@ -164,9 +165,9 @@
   questionNodeId String?
 }
 model Link {
-  id              String        @default(cuid()) @id
+  id              String        @id @default(cuid())
   createdAt       DateTime      @default(now())
   updatedAt       DateTime?     @updatedAt
   title           String?
   type            LinkTypeEnum
@@ -180,9 +181,9 @@
 model Edge {
   childNodeId                String
   createdAt                  DateTime            @default(now())
   updatedAt                  DateTime            @updatedAt
-  id                         String              @default(cuid()) @id
+  id                         String              @id @default(cuid())
   parentNodeId               String
   dialogueId                 String?
   conditions                 QuestionCondition[]
   isEdgeOf                   QuestionNode[]      @relation("EdgeChildrenRelation")
@@ -195,18 +196,18 @@
 }
 model QuestionCondition {
   conditionType String
-  id            Int     @default(autoincrement()) @id
+  id            Int     @id @default(autoincrement())
   matchValue    String?
   renderMax     Int?
   renderMin     Int?
   edgeId        String?
   Edge          Edge?   @relation(fields: [edgeId], references: [id])
 }
 model QuestionOption {
-  id             Int           @default(autoincrement()) @id
+  id             Int           @id @default(autoincrement())
   publicValue    String?
   value          String
   questionId     String?
   question       QuestionNode? @relation("QuestionNodeOptions", fields: [questionId], references: [id])
@@ -215,9 +216,9 @@
 }
 model Session {
   createdAt   DateTime    @default(now())
-  id          String      @default(cuid()) @id
+  id          String      @id @default(cuid())
   dialogueId  String
   dialogue    Dialogue    @relation(fields: [dialogueId], references: [id])
   nodeEntries NodeEntry[]
 }
@@ -228,9 +229,9 @@
   INIT_GENERATED
 }
 model NodeEntry {
-  id            String        @default(cuid()) @id
+  id            String        @id @default(cuid())
   creationDate  DateTime      @default(now())
   depth         Int?
   relatedEdgeId String?
   relatedNodeId String?
@@ -248,45 +249,45 @@
   linkNodeEntry         LinkNodeEntry?
 }
 model LinkNodeEntry {
-  id          Int       @default(autoincrement()) @id
+  id          Int       @id @default(autoincrement())
   value       Json?
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
 model SliderNodeEntry {
-  id          Int       @default(autoincrement()) @id
+  id          Int       @id @default(autoincrement())
   value       Int?
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
 model ChoiceNodeEntry {
-  id          Int       @default(autoincrement()) @id
+  id          Int       @id @default(autoincrement())
   value       String?
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
 model TextboxNodeEntry {
-  id          Int       @default(autoincrement()) @id
+  id          Int       @id @default(autoincrement())
   value       String?
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
 model RegistrationNodeEntry {
-  id          Int       @default(autoincrement()) @id
+  id          Int       @id @default(autoincrement())
   value       Json?
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
 // Permissions
 model Permission {
-  id          String    @default(cuid()) @id
+  id          String    @id @default(cuid())
   name        String
   description String?
   Customer    Customer? @relation(fields: [customerId], references: [id])
   customerId  String?
@@ -317,21 +318,22 @@
   CUSTOM
 }
 model Role {
-  id          String                 @default(cuid()) @id
+  id          String                 @id @default(cuid())
   name        String
   type        RoleTypeEnum           @default(value: USER)
   isPrivate   Boolean                @default(false)
   permissions SystemPermissionEnum[]
   users       UserOfCustomer[]
+  Customer    Customer?              @relation(fields: [customerId], references: [id])
+  customerId  String?
+
   @@unique([id, name])
-  Customer   Customer? @relation(fields: [customerId], references: [id])
-  customerId String?
 }
 model User {
-  id                 String                 @default(cuid()) @id
+  id                 String                 @id @default(cuid())
   createdAt          DateTime               @default(now())
   updatedAt          DateTime?              @updatedAt
   email              String                 @unique
   password           String?
@@ -382,26 +384,44 @@
   TEXT_MATCH
 }
 model TriggerCondition {
-  id        Int                  @default(autoincrement()) @id
-  type      TriggerConditionEnum @default(value: LOW_THRESHOLD)
-  minValue  Int?
-  maxValue  Int?
-  textValue String?
-  trigger   Trigger              @relation(fields: [triggerId], references: [id])
-  triggerId String
+  id                Int                  @id @default(autoincrement())
+  createdAt         DateTime?             @default(now())
+  type              TriggerConditionEnum @default(value: LOW_THRESHOLD)
+  minValue          Int?
+  maxValue          Int?
+  textValue         String?
+  trigger           Trigger              @relation(fields: [triggerId], references: [id])
+  triggerId         String
+  QuestionOfTrigger QuestionOfTrigger[]
 }
 model Trigger {
-  id            String             @default(cuid()) @id
-  lastSent      DateTime?
-  name          String
-  type          TriggerEnum        @default(value: QUESTION)
-  medium        TriggerMedium
-  conditions    TriggerCondition[]
-  relatedNodeId String?
-  relatedNode   QuestionNode?      @relation(fields: [relatedNodeId], references: [id])
-  recipients    User[]
-  customer      Customer?          @relation(fields: [customerId], references: [id])
-  customerId    String?
+  id                String              @id @default(cuid())
+  lastSent          DateTime?
+  name              String
+  type              TriggerEnum         @default(value: QUESTION)
+  medium            TriggerMedium
+  conditions        TriggerCondition[]
+  relatedNodeId     String?
+  relatedNode       QuestionNode?       @relation(fields: [relatedNodeId], references: [id])
+  recipients        User[]
+  customer          Customer?           @relation(fields: [customerId], references: [id])
+  customerId        String?
+  QuestionOfTrigger QuestionOfTrigger[]
 }
+
+model QuestionOfTrigger {
+  questionId String
+  question   QuestionNode @relation(fields: [questionId], references: [id])
+
+  triggerId String
+  trigger   Trigger @relation(fields: [triggerId], references: [id])
+
+  triggerConditionId Int
+  triggerCondition   TriggerCondition @relation(fields: [triggerConditionId], references: [id])
+
+  createdAt DateTime @default(now())
+
+  @@id([questionId, triggerId])
+}
```


