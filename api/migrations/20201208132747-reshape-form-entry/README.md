# Migration `20201208132747-reshape-form-entry`

This migration has been generated by Jonathan at 12/8/2020, 2:27:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."FormNodeEntry" DROP CONSTRAINT "FormNodeEntry_formNodeEntryDataId_fkey"

ALTER TABLE "public"."FormNodeEntry" DROP COLUMN "formNodeEntryDataId"

CREATE TABLE "public"."FormNodeFieldEntryData" (
"id" SERIAL,
"email" text   ,
"phoneNumber" text   ,
"url" text   ,
"shortText" text   ,
"longText" text   ,
"number" text   ,
"relatedFieldId" text   NOT NULL ,
"formNodeEntryId" integer   ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."FormNodeFieldEntryData" ADD FOREIGN KEY ("relatedFieldId")REFERENCES "public"."FormNodeField"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeFieldEntryData" ADD FOREIGN KEY ("formNodeEntryId")REFERENCES "public"."FormNodeEntry"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."FormNodeEntryData"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201207141627-reset-6..20201208132747-reshape-form-entry
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -132,21 +132,26 @@
   createdAt     DateTime        @default(now())
   fields        FormNodeField[]
 }
-model FormNodeEntryData {
+model FormNodeFieldEntryData {
   id          Int       @id @default(autoincrement())
+
+  // Data property (belonging to a specific field)
   email       String?
   phoneNumber String?
   url         String?
   shortText   String?
   longText    String?
   number      String?
+
+  relatedFieldId  String
+  relatedField  FormNodeField @relation(references: [id], fields: [relatedFieldId])
 }
 model FormNodeEntry {
   id          Int       @id @default(autoincrement())
-  value       FormNodeEntryData
+  values      FormNodeFieldEntryData[]
   // Relation to node
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
@@ -315,9 +320,9 @@
   // @Deprecated => FormNodeEntry
   registrationNodeEntry RegistrationNodeEntry?
-  formNodeEntry FormNodeEntry?
+  formNodeEntry         FormNodeEntry?
   linkNodeEntry         LinkNodeEntry?
 }
 model LinkNodeEntry {
```


