# Migration `20201214084422-job-model`

This migration has been generated by Cold-A-Muse at 12/14/2020, 9:44:22 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."JobType" AS ENUM ('CREATE_WORKSPACE_JOB')

CREATE TYPE "public"."CloudReferenceType" AS ENUM ('AWS', 'GCP', 'Azure', 'IBM')

CREATE TYPE "public"."JobStatusType" AS ENUM ('PENDING', 'COMPLETED', 'FAILED')

CREATE TABLE "public"."Job" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"type" "JobType"  NOT NULL ,
"createWorkspaceJobId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CreateWorkspaceJob" (
"id" text   NOT NULL ,
"referenceId" text   ,
"referenceType" "CloudReferenceType"  NOT NULL ,
"status" "JobStatusType"  NOT NULL DEFAULT E'PENDING',
"resourcesUrl" text   ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Job_createWorkspaceJobId_unique" ON "public"."Job"("createWorkspaceJobId")

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("createWorkspaceJobId")REFERENCES "public"."CreateWorkspaceJob"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201208134932-change-number..20201214084422-job-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -119,23 +119,27 @@
   number
 }
 model FormNodeField {
-  id    String        @id @default(cuid())
-  label String
-  type  FormNodeFieldType @default(shortText)
-  isRequired  Boolean @default(false)
-  position  Int
+  id                     String                   @id @default(cuid())
+  label                  String
+  type                   FormNodeFieldType        @default(shortText)
+  isRequired             Boolean                  @default(false)
+  position               Int
+  FormNode               FormNode?                @relation(fields: [formNodeId], references: [id])
+  formNodeId             String?
+  FormNodeFieldEntryData FormNodeFieldEntryData[]
 }
 model FormNode {
-  id           String           @id @default(cuid())
-  createdAt     DateTime        @default(now())
-  fields        FormNodeField[]
+  id           String          @id @default(cuid())
+  createdAt    DateTime        @default(now())
+  fields       FormNodeField[]
+  QuestionNode QuestionNode[]
 }
 model FormNodeFieldEntryData {
-  id          Int       @id @default(autoincrement())
+  id Int @id @default(autoincrement())
   // Data property (belonging to a specific field)
   email       String?
   phoneNumber String?
@@ -144,38 +148,43 @@
   longText    String?
   number      Int?
   relatedFieldId  String
-  relatedField  FormNodeField @relation(references: [id], fields: [relatedFieldId])
+  relatedField    FormNodeField  @relation(references: [id], fields: [relatedFieldId])
+  FormNodeEntry   FormNodeEntry? @relation(fields: [formNodeEntryId], references: [id])
+  formNodeEntryId Int?
 }
 model FormNodeEntry {
-  id          Int       @id @default(autoincrement())
-  values      FormNodeFieldEntryData[]
+  id     Int                      @id @default(autoincrement())
+  values FormNodeFieldEntryData[]
   // Relation to node
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
 model SliderNodeRange {
-  id        String          @id @default(cuid())
-  start     Float?
-  end       Float?
+  id               String             @id @default(cuid())
+  start            Float?
+  end              Float?
+  SliderNodeMarker SliderNodeMarker[]
 }
 model SliderNodeMarker {
-  id        String          @id @default(cuid())
-  range     SliderNodeRange
-  label     String
-  subLabel  String
-  sliderNodeId  String
-  sliderNode    SliderNode  @relation(fields: [sliderNodeId], references: [id])
+  id                String          @id @default(cuid())
+  range             SliderNodeRange @relation(fields: [sliderNodeRangeId], references: [id])
+  label             String
+  subLabel          String
+  sliderNodeId      String
+  sliderNode        SliderNode      @relation(fields: [sliderNodeId], references: [id])
+  sliderNodeRangeId String
 }
 model SliderNode {
-  id        String          @id @default(cuid())
-  markers SliderNodeMarker[]
+  id           String             @id @default(cuid())
+  markers      SliderNodeMarker[]
+  QuestionNode QuestionNode[]
 }
 model QuestionNode {
   id           String           @id @default(cuid())
@@ -206,13 +215,15 @@
   triggers       Trigger[]
   // Node-types
   share      Share?
-  sliderNode SliderNode?
-  form  FormNode?
+  sliderNode SliderNode? @relation(fields: [sliderNodeId], references: [id])
+  form       FormNode?   @relation(fields: [formNodeId], references: [id])
   links             Link[]
   QuestionOfTrigger QuestionOfTrigger[]
+  sliderNodeId      String?
+  formNodeId        String?
 }
 enum LinkTypeEnum {
   SOCIAL
@@ -313,17 +324,17 @@
   relatedEdge   Edge?         @relation(fields: [relatedEdgeId], references: [id])
   inputSource   InputSource   @default(value: CLIENT)
   // Entry types
-  sliderNodeEntry       SliderNodeEntry?
-  choiceNodeEntry       ChoiceNodeEntry?
-  textboxNodeEntry      TextboxNodeEntry?
-  
+  sliderNodeEntry  SliderNodeEntry?
+  choiceNodeEntry  ChoiceNodeEntry?
+  textboxNodeEntry TextboxNodeEntry?
+
   // @Deprecated => FormNodeEntry
   registrationNodeEntry RegistrationNodeEntry?
-  
-  formNodeEntry         FormNodeEntry?
-  linkNodeEntry         LinkNodeEntry?
+
+  formNodeEntry FormNodeEntry?
+  linkNodeEntry LinkNodeEntry?
 }
 model LinkNodeEntry {
   id          Int       @id @default(autoincrement())
@@ -501,4 +512,39 @@
   createdAt DateTime @default(now())
   @@id([questionId, triggerId])
 }
+
+enum JobType {
+  CREATE_WORKSPACE_JOB
+}
+
+model Job {
+  id                   String              @id @default(cuid())
+  createdAt            DateTime?           @default(now())
+  updatedAt            DateTime?           @updatedAt
+  type                 JobType
+  createWorkspaceJob   CreateWorkspaceJob? @relation(references: [id], fields: [createWorkspaceJobId])
+  createWorkspaceJobId String?
+}
+
+enum CloudReferenceType {
+  AWS
+  GCP
+  Azure
+  IBM
+}
+
+enum JobStatusType {
+  PENDING
+  COMPLETED
+  FAILED
+}
+
+model CreateWorkspaceJob {
+  id            String             @id @default(cuid())
+  referenceId   String?
+  referenceType CloudReferenceType
+  status        JobStatusType      @default(PENDING)
+  resourcesUrl  String?
+  Job           Job
+}
```


