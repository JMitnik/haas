# Migration `20200604132506-added-users-and-roles`

This migration has been generated by Cold-A-Muse at 6/4/2020, 1:25:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Permission" (
"description" text   ,"id" text  NOT NULL ,"name" text  NOT NULL ,"roleId" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Role" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"customerId" text   ,"editedAt" timestamp(3)  NOT NULL ,"email" text  NOT NULL ,"firstName" text   ,"id" text  NOT NULL ,"lastName" text   ,"phone" text   ,"roleId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Permission" ADD FOREIGN KEY ("roleId")REFERENCES "public"."Role"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("roleId")REFERENCES "public"."Role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200512103521-init..20200604132506-added-users-and-roles
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url      = env("DB_STRING")
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -53,8 +53,9 @@
   slug      String            @unique
   name      String
   settings  CustomerSettings?
   dialogues Dialogue[]
+  users     User[]
 }
 model Dialogue {
   creationDate DateTime       @default(now())
@@ -66,9 +67,9 @@
   publicTitle  String?
   title        String
   edges        Edge[]
   questions    QuestionNode[]
-  sessions     Session[]     
+  sessions     Session[]
 }
 model QuestionNode {
   id                         String           @default(cuid()) @id
@@ -88,8 +89,10 @@
   isChildNodeOf              Edge[]           @relation("Edge_childNodeToQuestionNode")
   isParentNodeOf             Edge[]           @relation("Edge_parentNodeToQuestionNode")
   isRelatedNodeOfNodeEntries NodeEntry[]
   edgeId                     String?
+  Edge                       Edge?            @relation("EdgeChildrenRelation", fields: [edgeId], references: [id])
+  QuestionOption             QuestionOption[] @relation("QuestionNodeOptions")
 }
 model Edge {
   childNodeId                String
@@ -104,8 +107,9 @@
   parentNode                 QuestionNode        @relation("Edge_parentNodeToQuestionNode", fields: [parentNodeId], references: [id])
   dialogue                   Dialogue?           @relation(fields: [dialogueId], references: [id])
   isRelatedNodeOfNodeEntries NodeEntry[]
   questionNodeId             String?
+  QuestionNode               QuestionNode?       @relation(fields: [questionNodeId], references: [id])
 }
 model QuestionCondition {
   conditionType String
@@ -113,8 +117,9 @@
   matchValue    String?
   renderMax     Int?
   renderMin     Int?
   edgeId        String?
+  Edge          Edge?   @relation(fields: [edgeId], references: [id])
 }
 model QuestionOption {
   id             Int           @default(autoincrement()) @id
@@ -122,8 +127,9 @@
   value          String
   questionId     String?
   question       QuestionNode? @relation("QuestionNodeOptions", fields: [questionId], references: [id])
   questionNodeId String?
+  QuestionNode   QuestionNode? @relation(fields: [questionNodeId], references: [id])
 }
 model Session {
   createdAt   DateTime    @default(now())
@@ -153,5 +159,36 @@
   parentNodeEntryValueId Int?
   parentNodeEntryValue   NodeEntryValue?  @relation("NodeEntryValueToNodeEntryValue", fields: [parentNodeEntryValueId], references: [id])
   multiValues            NodeEntryValue[] @relation("NodeEntryValueToNodeEntryValue")
   nodeEntryId            String?
+  NodeEntry              NodeEntry?       @relation(fields: [nodeEntryId], references: [id])
 }
+
+model Permission {
+  id          String  @default(cuid()) @id
+  name        String
+  description String?
+  Role        Role?   @relation(fields: [roleId], references: [id])
+  roleId      String?
+}
+
+model Role {
+  id          String       @default(cuid()) @id
+  name        String
+  permissions Permission[]
+  User        User[]
+}
+
+model User {
+  id         String    @default(cuid()) @id
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  editedAt   DateTime
+  email      String
+  phone      String?
+  firstName  String?
+  lastName   String?
+  roleId     String
+  role       Role      @relation(fields: [roleId], references: [id])
+  Customer   Customer? @relation(fields: [customerId], references: [id])
+  customerId String?
+}
```


