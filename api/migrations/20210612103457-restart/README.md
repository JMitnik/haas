# Migration `20210612103457-restart`

This migration has been generated by Jonathan at 6/12/2021, 12:34:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TYPE "CampaignVariantEdgeConditionEnum"

DROP TYPE "CampaignVariantScheduleTypeEnum"

CREATE TABLE "public"."ColourSettings" (
"dark" text   ,
"darkest" text   ,
"error" text   ,
"id" SERIAL,
"light" text   ,
"lightest" text   ,
"muted" text   ,
"normal" text   ,
"primary" text   NOT NULL ,
"primaryAlt" text   ,
"secondary" text   ,
"success" text   ,
"tertiary" text   ,
"text" text   ,
"warning" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FontSettings" (
"body" text   ,
"fontTitle" text   ,
"id" SERIAL,
"settingTitle" text   ,
"special" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CustomerSettings" (
"id" SERIAL,
"logoUrl" text   ,
"colourSettingsId" integer   ,
"fontSettingsId" integer   ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Customer" (
"id" text   NOT NULL ,
"slug" text   NOT NULL ,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Tag" (
"id" text   NOT NULL ,
"type" "TagEnum"  NOT NULL DEFAULT E'DEFAULT',
"name" text   NOT NULL ,
"customerId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Dialogue" (
"id" text   NOT NULL ,
"title" text   NOT NULL ,
"slug" text   NOT NULL ,
"description" text   NOT NULL ,
"creationDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"publicTitle" text   ,
"customerId" text   NOT NULL ,
"isOnline" boolean   NOT NULL DEFAULT false,
"isWithoutGenData" boolean   NOT NULL DEFAULT false,
"endScreenText" text   ,
"wasGeneratedWithGenData" boolean   NOT NULL DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeField" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"type" "FormNodeFieldType"  NOT NULL DEFAULT E'shortText',
"isRequired" boolean   NOT NULL DEFAULT false,
"position" integer   NOT NULL ,
"formNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNode" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeFieldEntryData" (
"id" SERIAL,
"email" text   ,
"phoneNumber" text   ,
"url" text   ,
"shortText" text   ,
"longText" text   ,
"number" integer   ,
"relatedFieldId" text   NOT NULL ,
"formNodeEntryId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeEntry" (
"id" SERIAL,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNodeRange" (
"id" text   NOT NULL ,
"start" Decimal(65,30)   ,
"end" Decimal(65,30)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNodeMarker" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"subLabel" text   NOT NULL ,
"sliderNodeId" text   NOT NULL ,
"sliderNodeRangeId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNode" (
"id" text   NOT NULL ,
"earlyReleaseText" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."VideoEmbeddedNode" (
"id" text   NOT NULL ,
"videoUrl" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionNode" (
"id" text   NOT NULL ,
"creationDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"isLeaf" boolean   NOT NULL DEFAULT false,
"isRoot" boolean   NOT NULL DEFAULT false,
"title" text   NOT NULL ,
"type" "NodeType"  NOT NULL DEFAULT E'GENERIC',
"overrideLeafId" text   ,
"questionDialogueId" text   ,
"edgeId" text   ,
"relatedTopicId" text   ,
"videoEmbeddedNodeId" text   ,
"sliderNodeId" text   ,
"formNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Share" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"url" text   NOT NULL ,
"title" text   NOT NULL ,
"tooltip" text   ,
"questionNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Link" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"title" text   ,
"type" "LinkTypeEnum"  NOT NULL ,
"url" text   NOT NULL ,
"iconUrl" text   ,
"backgroundColor" text   ,
"questionNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Edge" (
"childNodeId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"id" text   NOT NULL ,
"parentNodeId" text   NOT NULL ,
"dialogueId" text   ,
"questionNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionCondition" (
"conditionType" text   NOT NULL ,
"id" SERIAL,
"matchValue" text   ,
"renderMax" integer   ,
"renderMin" integer   ,
"edgeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionOption" (
"id" SERIAL,
"publicValue" text   ,
"value" text   NOT NULL ,
"overrideLeafId" text   ,
"questionId" text   ,
"questionNodeId" text   ,
"relatedTopicValueId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Topic" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"relatedDialogueId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TopicValue" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"parentTopicId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Session" (
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" text   NOT NULL ,
"dialogueId" text   NOT NULL ,
"deliveryId" text   ,
"originUrl" text   ,
"totalTimeInSec" integer   ,
"device" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."NodeEntry" (
"id" text   NOT NULL ,
"creationDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"depth" integer   ,
"relatedEdgeId" text   ,
"relatedNodeId" text   ,
"sessionId" text   ,
"inputSource" "InputSource"  NOT NULL DEFAULT E'CLIENT',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."LinkNodeEntry" (
"id" SERIAL,
"value" jsonb   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SliderNodeEntry" (
"id" SERIAL,
"value" integer   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ChoiceNodeEntry" (
"id" SERIAL,
"value" text   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TextboxNodeEntry" (
"id" SERIAL,
"value" text   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RegistrationNodeEntry" (
"id" SERIAL,
"value" jsonb   ,
"nodeEntryId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Permission" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Role" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"type" "RoleTypeEnum"  NOT NULL DEFAULT E'USER',
"isPrivate" boolean   NOT NULL DEFAULT false,
"permissions" "SystemPermissionEnum"[]  ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"email" text   NOT NULL ,
"password" text   ,
"phone" text   ,
"firstName" text   ,
"lastName" text   ,
"globalPermissions" "SystemPermissionEnum"[]  ,
"loginToken" text   ,
"loginTokenExpiry" timestamp(3)   ,
"refreshToken" text   ,
"refreshTokenExpiry" timestamp(3)   ,
"lastActivity" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserOfCustomer" (
"userId" text   NOT NULL ,
"customerId" text   NOT NULL ,
"roleId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","customerId")
)

CREATE TABLE "public"."TriggerCondition" (
"id" SERIAL,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"type" "TriggerConditionEnum"  NOT NULL DEFAULT E'LOW_THRESHOLD',
"minValue" integer   ,
"maxValue" integer   ,
"textValue" text   ,
"triggerId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Trigger" (
"id" text   NOT NULL ,
"lastSent" timestamp(3)   ,
"name" text   NOT NULL ,
"type" "TriggerEnum"  NOT NULL DEFAULT E'QUESTION',
"medium" "TriggerMedium"  NOT NULL ,
"relatedNodeId" text   ,
"customerId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QuestionOfTrigger" (
"questionId" text   NOT NULL ,
"triggerId" text   NOT NULL ,
"triggerConditionId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("questionId","triggerId")
)

CREATE TABLE "public"."Job" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"type" "JobType"  NOT NULL ,
"createWorkspaceJobId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."JobProcessLocation" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"path" text   NOT NULL ,
"xMaterialDimension" integer   NOT NULL DEFAULT 0,
"yMaterialDimension" integer   NOT NULL DEFAULT 0,
"type" "JobProcessLocationType"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CustomField" (
"id" text   NOT NULL ,
"key" text   NOT NULL ,
"value" text   NOT NULL ,
"jobProcessLocationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CreateWorkspaceJob" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"name" text   ,
"referenceId" text   ,
"message" text   ,
"errorMessage" text   ,
"referenceType" "CloudReferenceType"  NOT NULL ,
"status" "JobStatusType"  NOT NULL DEFAULT E'PENDING',
"resourcesUrl" text   ,
"requiresRembg" boolean   NOT NULL DEFAULT true,
"requiresScreenshot" boolean   NOT NULL DEFAULT true,
"requiresColorExtraction" boolean   NOT NULL DEFAULT true,
"jobProcessLocationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Campaign" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"workspaceId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CampaignVariantToCampaign" (
"campaignId" text   NOT NULL ,
"campaignVariantId" text   NOT NULL ,
"weight" integer   NOT NULL ,
PRIMARY KEY ("campaignId","campaignVariantId")
)

CREATE TABLE "public"."CampaignVariant" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"body" text   NOT NULL ,
"subject" text   ,
"type" "CampaignVariantTypeEnum"  NOT NULL ,
"customerId" text   NOT NULL ,
"dialogueId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Delivery" (
"id" text   NOT NULL ,
"deliveryRecipientFirstName" text   ,
"deliveryRecipientLastName" text   ,
"deliveryRecipientEmail" text   ,
"deliveryRecipientPhone" text   ,
"campaignId" text   NOT NULL ,
"campaignVariantId" text   NOT NULL ,
"currentStatus" "DeliveryStatusTypeEnum"  NOT NULL ,
"scheduledAt" timestamp(3)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."DeliveryEvents" (
"id" text   NOT NULL ,
"status" "DeliveryStatusTypeEnum"  NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deliveryId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_DialogueToTag" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_TriggerToUser" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "CustomerSettings.customerId_unique" ON "public"."CustomerSettings"("customerId")

CREATE UNIQUE INDEX "CustomerSettings_colourSettingsId_unique" ON "public"."CustomerSettings"("colourSettingsId")

CREATE UNIQUE INDEX "CustomerSettings_fontSettingsId_unique" ON "public"."CustomerSettings"("fontSettingsId")

CREATE UNIQUE INDEX "Customer.slug_unique" ON "public"."Customer"("slug")

CREATE UNIQUE INDEX "Dialogue.slug_customerId_unique" ON "public"."Dialogue"("slug", "customerId")

CREATE UNIQUE INDEX "FormNodeEntry_nodeEntryId_unique" ON "public"."FormNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "Share_questionNodeId_unique" ON "public"."Share"("questionNodeId")

CREATE UNIQUE INDEX "LinkNodeEntry_nodeEntryId_unique" ON "public"."LinkNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "SliderNodeEntry_nodeEntryId_unique" ON "public"."SliderNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "ChoiceNodeEntry_nodeEntryId_unique" ON "public"."ChoiceNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "TextboxNodeEntry_nodeEntryId_unique" ON "public"."TextboxNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "RegistrationNodeEntry_nodeEntryId_unique" ON "public"."RegistrationNodeEntry"("nodeEntryId")

CREATE UNIQUE INDEX "Role.id_name_unique" ON "public"."Role"("id", "name")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Job_createWorkspaceJobId_unique" ON "public"."Job"("createWorkspaceJobId")

CREATE UNIQUE INDEX "_DialogueToTag_AB_unique" ON "public"."_DialogueToTag"("A", "B")

CREATE INDEX "_DialogueToTag_B_index" ON "public"."_DialogueToTag"("B")

CREATE UNIQUE INDEX "_TriggerToUser_AB_unique" ON "public"."_TriggerToUser"("A", "B")

CREATE INDEX "_TriggerToUser_B_index" ON "public"."_TriggerToUser"("B")

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("colourSettingsId")REFERENCES "public"."ColourSettings"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("fontSettingsId")REFERENCES "public"."FontSettings"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Dialogue" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeField" ADD FOREIGN KEY ("formNodeId")REFERENCES "public"."FormNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeFieldEntryData" ADD FOREIGN KEY ("relatedFieldId")REFERENCES "public"."FormNodeField"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeFieldEntryData" ADD FOREIGN KEY ("formNodeEntryId")REFERENCES "public"."FormNodeEntry"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SliderNodeMarker" ADD FOREIGN KEY ("sliderNodeRangeId")REFERENCES "public"."SliderNodeRange"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SliderNodeMarker" ADD FOREIGN KEY ("sliderNodeId")REFERENCES "public"."SliderNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("overrideLeafId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("questionDialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("edgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("sliderNodeId")REFERENCES "public"."SliderNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("formNodeId")REFERENCES "public"."FormNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("videoEmbeddedNodeId")REFERENCES "public"."VideoEmbeddedNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("relatedTopicId")REFERENCES "public"."Topic"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Share" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Link" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("childNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("parentNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionCondition" ADD FOREIGN KEY ("edgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("overrideLeafId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("questionId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("relatedTopicValueId")REFERENCES "public"."TopicValue"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Topic" ADD FOREIGN KEY ("relatedDialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TopicValue" ADD FOREIGN KEY ("parentTopicId")REFERENCES "public"."Topic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("deliveryId")REFERENCES "public"."Delivery"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("sessionId")REFERENCES "public"."Session"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("relatedNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("relatedEdgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."LinkNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SliderNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ChoiceNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TextboxNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RegistrationNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Permission" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Role" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."UserOfCustomer" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOfCustomer" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOfCustomer" ADD FOREIGN KEY ("roleId")REFERENCES "public"."Role"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TriggerCondition" ADD FOREIGN KEY ("triggerId")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Trigger" ADD FOREIGN KEY ("relatedNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Trigger" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOfTrigger" ADD FOREIGN KEY ("questionId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOfTrigger" ADD FOREIGN KEY ("triggerId")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOfTrigger" ADD FOREIGN KEY ("triggerConditionId")REFERENCES "public"."TriggerCondition"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Job" ADD FOREIGN KEY ("createWorkspaceJobId")REFERENCES "public"."CreateWorkspaceJob"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CustomField" ADD FOREIGN KEY ("jobProcessLocationId")REFERENCES "public"."JobProcessLocation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CreateWorkspaceJob" ADD FOREIGN KEY ("jobProcessLocationId")REFERENCES "public"."JobProcessLocation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Campaign" ADD FOREIGN KEY ("workspaceId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariantToCampaign" ADD FOREIGN KEY ("campaignId")REFERENCES "public"."Campaign"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariantToCampaign" ADD FOREIGN KEY ("campaignVariantId")REFERENCES "public"."CampaignVariant"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariant" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CampaignVariant" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Delivery" ADD FOREIGN KEY ("campaignId")REFERENCES "public"."Campaign"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Delivery" ADD FOREIGN KEY ("campaignVariantId")REFERENCES "public"."CampaignVariant"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."DeliveryEvents" ADD FOREIGN KEY ("deliveryId")REFERENCES "public"."Delivery"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_DialogueToTag" ADD FOREIGN KEY ("A")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_DialogueToTag" ADD FOREIGN KEY ("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TriggerToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_TriggerToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20210612103457-restart
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,750 @@
+datasource postgresql {
+  provider = "postgresql"
+  url = "***"
+}
+
+// binaryTargets = ["debian-openssl-1.1.x"]
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["transactionApi"]
+  output          = "./node_modules/@prisma/client"
+}
+
+model ColourSettings {
+  dark             String?
+  darkest          String?
+  error            String?
+  id               Int               @id @default(autoincrement())
+  light            String?
+  lightest         String?
+  muted            String?
+  normal           String?
+  primary          String
+  primaryAlt       String?
+  secondary        String?
+  success          String?
+  tertiary         String?
+  text             String?
+  warning          String?
+  customerSettings CustomerSettings?
+}
+
+model FontSettings {
+  body             String?
+  fontTitle        String?
+  id               Int               @id @default(autoincrement())
+  settingTitle     String?
+  special          String?
+  customerSettings CustomerSettings?
+}
+
+model CustomerSettings {
+  id               Int             @id @default(autoincrement())
+  logoUrl          String?
+  colourSettingsId Int?
+  colourSettings   ColourSettings? @relation(fields: [colourSettingsId], references: [id])
+  fontSettingsId   Int?
+  fontSettings     FontSettings?   @relation(fields: [fontSettingsId], references: [id])
+  customerId       String?         @unique
+  customer         Customer?       @relation(fields: [customerId], references: [id])
+}
+
+model Customer {
+  id              String            @id @default(cuid())
+  slug            String            @unique
+  name            String
+  settings        CustomerSettings?
+  dialogues       Dialogue[]
+  users           UserOfCustomer[]
+  roles           Role[]
+  permissions     Permission[]
+  triggers        Trigger[]
+  tags            Tag[]
+  campaigns       Campaign[]
+  CampaignVariant CampaignVariant[]
+}
+
+enum TagEnum {
+  DEFAULT
+  AGENT
+  LOCATION
+}
+
+model Tag {
+  id         String     @id @default(cuid())
+  type       TagEnum    @default(value: DEFAULT)
+  name       String
+  isTagOf    Dialogue[] @relation(references: [id])
+  customer   Customer   @relation(fields: [customerId], references: [id])
+  customerId String
+}
+
+model Dialogue {
+  id               String         @id @default(cuid())
+  title            String
+  slug             String
+  description      String
+  creationDate     DateTime       @default(now())
+  updatedAt        DateTime?      @updatedAt
+  publicTitle      String?
+  customerId       String
+  customer         Customer       @relation(fields: [customerId], references: [id])
+  edges            Edge[]
+  questions        QuestionNode[]
+  sessions         Session[]
+  tags             Tag[]
+  isOnline         Boolean        @default(value: false)
+  isWithoutGenData Boolean        @default(value: false)
+
+  endScreenText String?
+
+  wasGeneratedWithGenData Boolean           @default(value: false)
+  CampaignVariant         CampaignVariant[]
+
+  topics  Topic[]
+
+  @@unique([slug, customerId])
+}
+
+enum NodeType {
+  GENERIC
+  SLIDER
+  FORM
+  CHOICE
+  REGISTRATION
+  TEXTBOX
+  LINK
+  SHARE
+  VIDEO_EMBEDDED
+}
+
+// NodeType: Form
+enum FormNodeFieldType {
+  email
+  phoneNumber
+  url
+  shortText
+  longText
+  number
+}
+
+model FormNodeField {
+  id                     String                   @id @default(cuid())
+  label                  String
+  type                   FormNodeFieldType        @default(shortText)
+  isRequired             Boolean                  @default(false)
+  position               Int
+  FormNode               FormNode?                @relation(fields: [formNodeId], references: [id])
+  formNodeId             String?
+  FormNodeFieldEntryData FormNodeFieldEntryData[]
+}
+
+model FormNode {
+  id           String          @id @default(cuid())
+  createdAt    DateTime        @default(now())
+  fields       FormNodeField[]
+  QuestionNode QuestionNode[]
+}
+
+model FormNodeFieldEntryData {
+  id Int @id @default(autoincrement())
+
+  // Data property (belonging to a specific field)
+  email       String?
+  phoneNumber String?
+  url         String?
+  shortText   String?
+  longText    String?
+  number      Int?
+
+  relatedFieldId  String
+  relatedField    FormNodeField  @relation(references: [id], fields: [relatedFieldId])
+  FormNodeEntry   FormNodeEntry? @relation(fields: [formNodeEntryId], references: [id])
+  formNodeEntryId Int?
+}
+
+model FormNodeEntry {
+  id     Int                      @id @default(autoincrement())
+  values FormNodeFieldEntryData[]
+
+  // Relation to node
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model SliderNodeRange {
+  id               String             @id @default(cuid())
+  start            Float?
+  end              Float?
+  SliderNodeMarker SliderNodeMarker[]
+}
+
+model SliderNodeMarker {
+  id                String          @id @default(cuid())
+  range             SliderNodeRange @relation(fields: [sliderNodeRangeId], references: [id])
+  label             String
+  subLabel          String
+  sliderNodeId      String
+  sliderNode        SliderNode      @relation(fields: [sliderNodeId], references: [id])
+  sliderNodeRangeId String
+}
+
+model SliderNode {
+  id           String             @id @default(cuid())
+  markers      SliderNodeMarker[]
+  QuestionNode QuestionNode[]
+
+  earlyReleaseText String?
+}
+
+model VideoEmbeddedNode {
+  id           String         @id @default(cuid())
+  videoUrl     String?
+  QuestionNode QuestionNode[]
+}
+
+model QuestionNode {
+  id           String           @id @default(cuid())
+  creationDate DateTime         @default(now())
+  updatedAt    DateTime         @updatedAt
+  isLeaf       Boolean          @default(false)
+  isRoot       Boolean          @default(false)
+  title        String
+  type         NodeType         @default(value: GENERIC)
+  options      QuestionOption[]
+  children     Edge[]
+
+  overrideLeafId   String?
+  overrideLeaf     QuestionNode?  @relation("QNodeToOverrideLeaf", fields: [overrideLeafId], references: [id])
+  isOverrideLeafOf QuestionNode[] @relation("QNodeToOverrideLeaf")
+
+  questionDialogue   Dialogue? @relation(fields: [questionDialogueId], references: [id])
+  questionDialogueId String?
+
+  isChildNodeOf              Edge[]      @relation("Edge_childNodeToQuestionNode")
+  isParentNodeOf             Edge[]      @relation("Edge_parentNodeToQuestionNode")
+  isRelatedNodeOfNodeEntries NodeEntry[]
+
+  edgeId String?
+  Edge   Edge?   @relation("EdgeChildrenRelation", fields: [edgeId], references: [id])
+
+  QuestionOption   QuestionOption[] @relation("QuestionNodeOptions")
+  triggers         Trigger[]
+  overridesChoices QuestionOption[] @relation("ChoiceCTANode")
+
+  // Node-types
+  share      Share?
+  sliderNode SliderNode? @relation(fields: [sliderNodeId], references: [id])
+  form       FormNode?   @relation(fields: [formNodeId], references: [id])
+  videoEmbeddedNode VideoEmbeddedNode? @relation(fields: [videoEmbeddedNodeId], references: [id])
+
+  links             Link[]
+  QuestionOfTrigger QuestionOfTrigger[]
+
+  // Topics
+  relatedTopicId  String?
+  relatedTopic  Topic? @relation(fields: [relatedTopicId], references: [id])
+
+  videoEmbeddedNodeId String?
+  sliderNodeId        String?
+  formNodeId          String?
+}
+
+enum LinkTypeEnum {
+  SOCIAL
+  API
+  FACEBOOK
+  LINKEDIN
+  WHATSAPP
+  INSTAGRAM
+  TWITTER
+}
+
+model Share {
+  id        String    @id @default(cuid())
+  createdAt DateTime? @default(now())
+  updatedAt DateTime? @updatedAt
+
+  url     String
+  title   String
+  tooltip String?
+
+  questionNode   QuestionNode? @relation(fields: [questionNodeId], references: [id])
+  questionNodeId String?
+}
+
+model Link {
+  id              String        @id @default(cuid())
+  createdAt       DateTime      @default(now())
+  updatedAt       DateTime?     @updatedAt
+  title           String?
+  type            LinkTypeEnum
+  url             String
+  iconUrl         String?
+  backgroundColor String?
+  questionNode    QuestionNode? @relation(fields: [questionNodeId], references: [id])
+  questionNodeId  String?
+}
+
+model Edge {
+  childNodeId                String
+  createdAt                  DateTime            @default(now())
+  updatedAt                  DateTime            @updatedAt
+  id                         String              @id @default(cuid())
+  parentNodeId               String
+  dialogueId                 String?
+  conditions                 QuestionCondition[]
+  isEdgeOf                   QuestionNode[]      @relation("EdgeChildrenRelation")
+  childNode                  QuestionNode        @relation("Edge_childNodeToQuestionNode", fields: [childNodeId], references: [id])
+  parentNode                 QuestionNode        @relation("Edge_parentNodeToQuestionNode", fields: [parentNodeId], references: [id])
+  dialogue                   Dialogue?           @relation(fields: [dialogueId], references: [id])
+  isRelatedNodeOfNodeEntries NodeEntry[]
+  questionNodeId             String?
+  QuestionNode               QuestionNode?       @relation(fields: [questionNodeId], references: [id])
+}
+
+model QuestionCondition {
+  conditionType String
+  id            Int     @id @default(autoincrement())
+  matchValue    String?
+  renderMax     Int?
+  renderMin     Int?
+  edgeId        String?
+  Edge          Edge?   @relation(fields: [edgeId], references: [id])
+}
+
+model QuestionOption {
+  id          Int     @id @default(autoincrement())
+  publicValue String?
+  value       String
+
+  overrideLeafId String?
+  overrideLeaf   QuestionNode? @relation("ChoiceCTANode", fields: [overrideLeafId], references: [id])
+
+  questionId String?
+  question   QuestionNode? @relation("QuestionNodeOptions", fields: [questionId], references: [id])
+
+  questionNodeId String?
+  QuestionNode   QuestionNode? @relation(fields: [questionNodeId], references: [id])
+
+  relatedTopicValueId String?
+  relatedTopicValue TopicValue? @relation(fields: [relatedTopicValueId], references: [id])
+}
+
+model Topic {
+  id  String  @id @default(cuid())
+  label String
+  values  TopicValue[]
+
+  relatedQuestions  QuestionNode[]
+
+  relatedDialogueId String
+  relatedDialogue Dialogue  @relation(fields: [relatedDialogueId], references: [id])
+}
+
+model TopicValue {
+  id  String  @id @default(cuid())
+  label String
+
+  parentTopicId String
+  parentTopic Topic @relation(fields: [parentTopicId], references: [id])
+  relatedChoices  QuestionOption[]
+}
+
+model Session {
+  createdAt   DateTime    @default(now())
+  id          String      @id @default(cuid())
+  dialogueId  String
+  dialogue    Dialogue    @relation(fields: [dialogueId], references: [id])
+  nodeEntries NodeEntry[]
+
+  deliveryId String?
+  delivery   Delivery? @relation(fields: [deliveryId], references: [id])
+
+  originUrl      String?
+  totalTimeInSec Int?
+  device         String?
+}
+
+// Node-entry types
+enum InputSource {
+  CLIENT
+  INIT_GENERATED
+}
+
+model NodeEntry {
+  id            String        @id @default(cuid())
+  creationDate  DateTime      @default(now())
+  depth         Int?
+  relatedEdgeId String?
+  relatedNodeId String?
+  sessionId     String?
+  session       Session?      @relation(fields: [sessionId], references: [id])
+  relatedNode   QuestionNode? @relation(fields: [relatedNodeId], references: [id])
+  relatedEdge   Edge?         @relation(fields: [relatedEdgeId], references: [id])
+  inputSource   InputSource   @default(value: CLIENT)
+
+  // Entry types
+  sliderNodeEntry  SliderNodeEntry?
+  choiceNodeEntry  ChoiceNodeEntry?
+  textboxNodeEntry TextboxNodeEntry?
+
+  // @Deprecated => FormNodeEntry
+  registrationNodeEntry RegistrationNodeEntry?
+
+  formNodeEntry FormNodeEntry?
+  linkNodeEntry LinkNodeEntry?
+}
+
+model LinkNodeEntry {
+  id          Int       @id @default(autoincrement())
+  value       Json?
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model SliderNodeEntry {
+  id          Int       @id @default(autoincrement())
+  value       Int?
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model ChoiceNodeEntry {
+  id          Int       @id @default(autoincrement())
+  value       String?
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model TextboxNodeEntry {
+  id          Int       @id @default(autoincrement())
+  value       String?
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+// @DEPRECATED
+model RegistrationNodeEntry {
+  id          Int       @id @default(autoincrement())
+  value       Json?
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+// Permissions
+model Permission {
+  id          String    @id @default(cuid())
+  name        String
+  description String?
+  Customer    Customer? @relation(fields: [customerId], references: [id])
+  customerId  String?
+}
+
+enum SystemPermissionEnum {
+  CAN_ACCESS_ADMIN_PANEL
+  CAN_EDIT_DIALOGUE
+  CAN_BUILD_DIALOGUE
+  CAN_VIEW_DIALOGUE
+  CAN_DELETE_DIALOGUE
+  CAN_VIEW_DIALOGUE_ANALYTICS
+  CAN_VIEW_USERS
+  CAN_ADD_USERS
+  CAN_DELETE_USERS
+  CAN_EDIT_USERS
+  CAN_CREATE_TRIGGERS
+  CAN_DELETE_TRIGGERS
+  CAN_DELETE_WORKSPACE
+  CAN_EDIT_WORKSPACE
+  // Campaign oriented
+  CAN_VIEW_CAMPAIGNS
+  CAN_CREATE_CAMPAIGNS
+  CAN_CREATE_DELIVERIES
+}
+
+enum RoleTypeEnum {
+  ADMIN
+  MANAGER
+  USER
+  GUEST
+  CUSTOM
+}
+
+model Role {
+  id          String                 @id @default(cuid())
+  name        String
+  type        RoleTypeEnum           @default(value: USER)
+  isPrivate   Boolean                @default(false)
+  permissions SystemPermissionEnum[]
+  users       UserOfCustomer[]
+  Customer    Customer?              @relation(fields: [customerId], references: [id])
+  customerId  String?
+
+  @@unique([id, name])
+}
+
+model User {
+  id                 String                 @id @default(cuid())
+  createdAt          DateTime               @default(now())
+  updatedAt          DateTime?              @updatedAt
+  email              String                 @unique
+  password           String?
+  phone              String?
+  firstName          String?
+  lastName           String?
+  triggers           Trigger[]
+  customers          UserOfCustomer[]
+  globalPermissions  SystemPermissionEnum[]
+  loginToken         String?
+  loginTokenExpiry   DateTime?
+  refreshToken       String?
+  refreshTokenExpiry DateTime?
+  lastActivity       DateTime?
+}
+
+model UserOfCustomer {
+  userId String
+  user   User   @relation(fields: [userId], references: [id])
+
+  customerId String
+  customer   Customer @relation(fields: [customerId], references: [id])
+
+  roleId String
+  role   Role   @relation(fields: [roleId], references: [id])
+
+  createdAt DateTime @default(now())
+
+  @@id([userId, customerId])
+}
+
+enum TriggerEnum {
+  QUESTION
+  SCHEDULED
+}
+
+enum TriggerMedium {
+  EMAIL
+  PHONE
+  BOTH
+}
+
+enum TriggerConditionEnum {
+  LOW_THRESHOLD
+  HIGH_THRESHOLD
+  INNER_RANGE
+  OUTER_RANGE
+  TEXT_MATCH
+}
+
+model TriggerCondition {
+  id                Int                  @id @default(autoincrement())
+  createdAt         DateTime?            @default(now())
+  type              TriggerConditionEnum @default(value: LOW_THRESHOLD)
+  minValue          Int?
+  maxValue          Int?
+  textValue         String?
+  trigger           Trigger              @relation(fields: [triggerId], references: [id])
+  triggerId         String
+  QuestionOfTrigger QuestionOfTrigger[]
+}
+
+model Trigger {
+  id                String              @id @default(cuid())
+  lastSent          DateTime?
+  name              String
+  type              TriggerEnum         @default(value: QUESTION)
+  medium            TriggerMedium
+  conditions        TriggerCondition[]
+  relatedNodeId     String?
+  relatedNode       QuestionNode?       @relation(fields: [relatedNodeId], references: [id])
+  recipients        User[]
+  customer          Customer?           @relation(fields: [customerId], references: [id])
+  customerId        String?
+  QuestionOfTrigger QuestionOfTrigger[]
+}
+
+model QuestionOfTrigger {
+  questionId String
+  question   QuestionNode @relation(fields: [questionId], references: [id])
+
+  triggerId String
+  trigger   Trigger @relation(fields: [triggerId], references: [id])
+
+  triggerConditionId Int
+  triggerCondition   TriggerCondition @relation(fields: [triggerConditionId], references: [id])
+
+  createdAt DateTime @default(now())
+
+  @@id([questionId, triggerId])
+}
+
+enum JobType {
+  CREATE_WORKSPACE_JOB
+}
+
+model Job {
+  id                   String              @id @default(cuid())
+  createdAt            DateTime?           @default(now())
+  updatedAt            DateTime?           @updatedAt
+  type                 JobType
+  createWorkspaceJob   CreateWorkspaceJob? @relation(references: [id], fields: [createWorkspaceJobId])
+  createWorkspaceJobId String?
+}
+
+enum CloudReferenceType {
+  AWS
+  GCP
+  Azure
+  IBM
+}
+
+enum JobStatusType {
+  PRE_PROCESSING
+  PRE_PROCESSING_LOGO
+  PRE_PROCESSING_WEBSITE_SCREENSHOT
+  READY_FOR_PROCESSING
+  IN_PHOTOSHOP_QUEUE
+  PHOTOSHOP_PROCESSING
+  PROCESSING
+  WRAPPING_UP
+  PENDING
+  COMPLETED
+  FAILED
+  TRANSFORMING_PSDS_TO_PNGS
+  STITCHING_SLIDES
+  COMPRESSING_SALES_MATERIAL
+}
+
+model JobProcessLocation {
+  id                 String                 @id @default(cuid())
+  name               String
+  path               String
+  xMaterialDimension Int                    @default(0)
+  yMaterialDimension Int                    @default(0)
+  type               JobProcessLocationType
+  job                CreateWorkspaceJob[]
+  fields             CustomField[]
+}
+
+model CustomField {
+  id                   String             @id @default(cuid())
+  key                  String
+  value                String
+  jobProcessLocation   JobProcessLocation @relation(fields: [jobProcessLocationId], references: [id])
+  jobProcessLocationId String
+}
+
+enum JobProcessLocationType {
+  ONE_PAGER
+  PITCHDECK
+  BROCHURE
+}
+
+model CreateWorkspaceJob {
+  id                      String             @id @default(cuid())
+  createdAt               DateTime?          @default(now())
+  updatedAt               DateTime?          @updatedAt
+  name                    String?
+  referenceId             String?
+  message                 String?
+  errorMessage            String?
+  referenceType           CloudReferenceType
+  status                  JobStatusType      @default(PENDING)
+  resourcesUrl            String?
+  requiresRembg           Boolean            @default(true)
+  requiresScreenshot      Boolean            @default(true)
+  requiresColorExtraction Boolean            @default(true)
+  Job                     Job
+  processLocation         JobProcessLocation @relation(fields: [jobProcessLocationId], references: [id])
+  jobProcessLocationId    String
+}
+
+// Campaigns
+enum CampaignVariantTypeEnum {
+  EMAIL
+  SMS
+  QUEUE
+}
+
+model Campaign {
+  id            String                      @id @default(cuid())
+  label         String
+  deliveries    Delivery[]
+  variantsEdges CampaignVariantToCampaign[]
+
+  workspaceId String
+  workspace   Customer @relation(fields: [workspaceId], references: [id])
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model CampaignVariantToCampaign {
+  campaignId String
+  campaign   Campaign @relation(fields: [campaignId], references: [id])
+
+  campaignVariantId String
+  campaignVariant   CampaignVariant @relation(fields: [campaignVariantId], references: [id])
+
+  // Weight decides in A/B testing which
+  weight Int
+
+  @@id([campaignId, campaignVariantId])
+}
+
+model CampaignVariant {
+  id    String @id @default(cuid())
+  label String
+  body  String
+
+  workspace Customer @relation(fields: [customerId], references: [id])
+  dialogue  Dialogue @relation(fields: [dialogueId], references: [id])
+
+  subject                   String?
+  type                      CampaignVariantTypeEnum
+  CampaignVariantToCampaign CampaignVariantToCampaign[]
+  Delivery                  Delivery[]
+  customerId                String
+  dialogueId                String
+}
+
+enum DeliveryStatusTypeEnum {
+  SCHEDULED
+  DEPLOYED
+  SENT
+  OPENED
+  FINISHED
+}
+
+model Delivery {
+  // We generated the ID ourselves
+  id String @id
+
+  deliveryRecipientFirstName String?
+  deliveryRecipientLastName  String?
+  deliveryRecipientEmail     String?
+  deliveryRecipientPhone     String?
+
+  campaignId String
+  campaign   Campaign @relation(fields: [campaignId], references: [id])
+
+  campaignVariantId String
+  campaignVariant   CampaignVariant @relation(fields: [campaignVariantId], references: [id])
+
+  currentStatus DeliveryStatusTypeEnum
+
+  events DeliveryEvents[]
+
+  scheduledAt DateTime
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime? @updatedAt
+  Session     Session[]
+}
+
+model DeliveryEvents {
+  id         String                 @id @default(cuid())
+  status     DeliveryStatusTypeEnum
+  createdAt  DateTime               @default(now())
+  deliveryId String?
+  Delivery   Delivery?              @relation(fields: [deliveryId], references: [id])
+}
```


