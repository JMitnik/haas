# Migration `20200721223038-make-customer-required`

This migration has been generated by Jonathan at 7/21/2020, 10:30:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "TagEnum" AS ENUM ('DEFAULT', 'AGENT', 'LOCATION');

CREATE TYPE "TriggerEnum" AS ENUM ('QUESTION', 'SCHEDULED');

CREATE TYPE "TriggerConditionEnum" AS ENUM ('LOW_THRESHOLD', 'HIGH_THRESHOLD', 'INNER_RANGE', 'OUTER_RANGE', 'TEXT_MATCH');

ALTER TABLE "public"."Tag" DROP COLUMN "type",
ADD COLUMN "type" "TagEnum" NOT NULL ,
ALTER COLUMN "customerId" SET NOT NULL;

ALTER TABLE "public"."Trigger" DROP COLUMN "type",
ADD COLUMN "type" "TriggerEnum" NOT NULL ;

ALTER TABLE "public"."TriggerCondition" DROP COLUMN "type",
ADD COLUMN "type" "TriggerConditionEnum" NOT NULL ;

DROP TYPE "TagType"

DROP TYPE "TriggerConditionType"

DROP TYPE "TriggerType"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200713192510-added..20200721223038-make-customer-required
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -60,21 +60,21 @@
   triggers    Trigger[]
   tags        Tag[]
 }
-enum TagType {
+enum TagEnum {
   DEFAULT
   AGENT
   LOCATION
 }
 model Tag {
   id         String     @default(cuid()) @id
-  type       TagType
+  type       TagEnum
   name       String
   isTagOf    Dialogue[] @relation(references: [id])
-  customer   Customer?  @relation(fields: [customerId], references: [id])
-  customerId String?
+  customer   Customer  @relation(fields: [customerId], references: [id])
+  customerId String
 }
 model Dialogue {
   id           String         @default(cuid()) @id
@@ -268,9 +268,9 @@
   triggers   Trigger[] @relation(references: [id])
   @@unique([customerId, email])
 }
-enum TriggerType {
+enum TriggerEnum {
   QUESTION
   SCHEDULED
 }
@@ -279,9 +279,9 @@
   PHONE
   BOTH
 }
-enum TriggerConditionType {
+enum TriggerConditionEnum {
   LOW_THRESHOLD
   HIGH_THRESHOLD
   INNER_RANGE
   OUTER_RANGE
@@ -289,9 +289,9 @@
 }
 model TriggerCondition {
   id        Int                  @default(autoincrement()) @id
-  type      TriggerConditionType
+  type      TriggerConditionEnum
   minValue  Int?
   maxValue  Int?
   textValue String?
   trigger   Trigger?             @relation(fields: [triggerId], references: [id])
@@ -301,9 +301,9 @@
 model Trigger {
   id            String             @default(cuid()) @id
   lastSent      DateTime?
   name          String
-  type          TriggerType
+  type          TriggerEnum
   medium        TriggerMedium
   conditions    TriggerCondition[]
   relatedNodeId String?
   relatedNode   QuestionNode?      @relation(fields: [relatedNodeId], references: [id])
```


