# Migration `20200605105852-made-role-permission-relation-many-to-many`

This migration has been generated by Cold-A-Muse at 6/5/2020, 10:58:52 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_PermissionToRole" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Permission" DROP CONSTRAINT IF EXiSTS "Permission_roleId_fkey",
DROP COLUMN "roleId";

CREATE UNIQUE INDEX "_PermissionToRole_AB_unique" ON "public"."_PermissionToRole"("A","B")

CREATE  INDEX "_PermissionToRole_B_index" ON "public"."_PermissionToRole"("B")

ALTER TABLE "public"."_PermissionToRole" ADD FOREIGN KEY ("A")REFERENCES "public"."Permission"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PermissionToRole" ADD FOREIGN KEY ("B")REFERENCES "public"."Role"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200605091337-added-customer-to-role-relation..20200605105852-made-role-permission-relation-many-to-many
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url      = env("DB_STRING")
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -167,16 +167,15 @@
 model Permission {
   id          String  @default(cuid()) @id
   name        String
   description String?
-  Role        Role?   @relation(fields: [roleId], references: [id])
-  roleId      String?
+  Role        Role[]  @relation(references: [id])
 }
 model Role {
   id          String       @default(cuid()) @id
   name        String
-  permissions Permission[]
+  permissions Permission[] @relation(references: [id])
   User        User[]
   Customer    Customer?    @relation(fields: [customerId], references: [id])
   customerId  String?
 }
```


