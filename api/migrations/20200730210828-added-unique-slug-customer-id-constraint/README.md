# Migration `20200730210828-added-unique-slug-customer-id-constraint`

This migration has been generated by Cold-A-Muse at 7/30/2020, 9:08:28 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE UNIQUE INDEX "Dialogue.slug_customerId" ON "public"."Dialogue"("slug","customerId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200724135612-icon-to-icon-url-link..20200730210828-added-unique-slug-customer-id-constraint
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -60,21 +60,21 @@
   triggers    Trigger[]
   tags        Tag[]
 }
-enum TagType {
+enum TagEnum {
   DEFAULT
   AGENT
   LOCATION
 }
 model Tag {
   id         String     @default(cuid()) @id
-  type       TagType
+  type       TagEnum
   name       String
   isTagOf    Dialogue[] @relation(references: [id])
-  customer   Customer?  @relation(fields: [customerId], references: [id])
-  customerId String?
+  customer   Customer  @relation(fields: [customerId], references: [id])
+  customerId String
 }
 model Dialogue {
   id           String         @default(cuid()) @id
@@ -89,30 +89,45 @@
   edges        Edge[]
   questions    QuestionNode[]
   sessions     Session[]
   tags         Tag[]
+  @@unique([slug, customerId])
 }
+enum NodeType {
+  GENERIC
+  SLIDER
+  CHOICE
+  REGISTRATION
+  TEXTBOX
+  LINK
+}
+
 model QuestionNode {
   id                         String           @default(cuid()) @id
   creationDate               DateTime         @default(now())
   updatedAt                  DateTime?        @updatedAt
   isLeaf                     Boolean          @default(false)
   isRoot                     Boolean          @default(false)
   title                      String
-  type                       String
+  type                       NodeType         @default(value: GENERIC)
   options                    QuestionOption[]
   children                   Edge[]
+
   overrideLeafId             String?
   overrideLeaf               QuestionNode?    @relation("QNodeToOverrideLeaf", fields: [overrideLeafId], references: [id])
   isOverrideLeafOf           QuestionNode[]   @relation("QNodeToOverrideLeaf")
+  
   questionDialogue           Dialogue?        @relation(fields: [questionDialogueId], references: [id])
   questionDialogueId         String?
+  
   isChildNodeOf              Edge[]           @relation("Edge_childNodeToQuestionNode")
   isParentNodeOf             Edge[]           @relation("Edge_parentNodeToQuestionNode")
   isRelatedNodeOfNodeEntries NodeEntry[]
+  
   edgeId                     String?
   Edge                       Edge?            @relation("EdgeChildrenRelation", fields: [edgeId], references: [id])
+  
   QuestionOption             QuestionOption[] @relation("QuestionNodeOptions")
   triggers                   Trigger[]
   links                      Link[]
 }
@@ -184,8 +199,10 @@
   dialogue    Dialogue    @relation(fields: [dialogueId], references: [id])
   nodeEntries NodeEntry[]
 }
+// Node-entry types
+
 model NodeEntry {
   id            String           @default(cuid()) @id
   creationDate  DateTime         @default(now())
   depth         Int?
@@ -194,22 +211,54 @@
   sessionId     String?
   session       Session?         @relation(fields: [sessionId], references: [id])
   relatedNode   QuestionNode?    @relation(fields: [relatedNodeId], references: [id])
   relatedEdge   Edge?            @relation(fields: [relatedEdgeId], references: [id])
-  values        NodeEntryValue[]
+  
+  // Entry types
+  sliderNodeEntry SliderNodeEntry?
+  choiceNodeEntry ChoiceNodeEntry?
+  textboxNodeEntry TextboxNodeEntry?
+  registrationNodeEntry RegistrationNodeEntry?
+  linkNodeEntry LinkNodeEntry?
 }
-model NodeEntryValue {
-  id                     Int              @default(autoincrement()) @id
-  numberValue            Int?
-  textValue              String?
-  parentNodeEntryValueId Int?
-  parentNodeEntryValue   NodeEntryValue?  @relation("NodeEntryValueToNodeEntryValue", fields: [parentNodeEntryValueId], references: [id])
-  multiValues            NodeEntryValue[] @relation("NodeEntryValueToNodeEntryValue")
-  nodeEntryId            String?
-  NodeEntry              NodeEntry?       @relation(fields: [nodeEntryId], references: [id])
+model LinkNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value Json?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
+model SliderNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value Int?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model ChoiceNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value String?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model TextboxNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value String?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model RegistrationNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value Json?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+// Permissions
+
 model Permission {
   id                 String    @default(cuid()) @id
   name               String
   description        String?
@@ -244,9 +293,9 @@
   triggers   Trigger[] @relation(references: [id])
   @@unique([customerId, email])
 }
-enum TriggerType {
+enum TriggerEnum {
   QUESTION
   SCHEDULED
 }
@@ -255,9 +304,9 @@
   PHONE
   BOTH
 }
-enum TriggerConditionType {
+enum TriggerConditionEnum {
   LOW_THRESHOLD
   HIGH_THRESHOLD
   INNER_RANGE
   OUTER_RANGE
@@ -265,21 +314,21 @@
 }
 model TriggerCondition {
   id        Int                  @default(autoincrement()) @id
-  type      TriggerConditionType
+  type      TriggerConditionEnum
   minValue  Int?
   maxValue  Int?
   textValue String?
-  trigger   Trigger?             @relation(fields: [triggerId], references: [id])
-  triggerId String?
+  trigger   Trigger             @relation(fields: [triggerId], references: [id])
+  triggerId String
 }
 model Trigger {
   id            String             @default(cuid()) @id
   lastSent      DateTime?
   name          String
-  type          TriggerType
+  type          TriggerEnum
   medium        TriggerMedium
   conditions    TriggerCondition[]
   relatedNodeId String?
   relatedNode   QuestionNode?      @relation(fields: [relatedNodeId], references: [id])
```


