# Migration `20200612093907-init`

This migration has been generated by Cold-A-Muse at 6/12/2020, 9:39:07 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "TriggerType" AS ENUM ('QUESTION', 'SCHEDULED');

CREATE TYPE "TriggerMedium" AS ENUM ('EMAIL', 'PHONE', 'BOTH');

CREATE TYPE "TriggerConditionType" AS ENUM ('LOW_THRESHOLD', 'HIGH_THRESHOLD', 'INNER_RANGE', 'OUTER_RANGE', 'TEXT_MATCH');

CREATE TABLE "public"."TriggerCondition" (
"id" SERIAL,"maxValue" integer   ,"minValue" integer   ,"textValue" text   ,"triggerId" text   ,"type" "TriggerConditionType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Trigger" (
"id" text  NOT NULL ,"medium" "TriggerMedium" NOT NULL ,"name" text  NOT NULL ,"type" "TriggerType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_TriggerToUser" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "_TriggerToUser_AB_unique" ON "public"."_TriggerToUser"("A","B")

CREATE  INDEX "_TriggerToUser_B_index" ON "public"."_TriggerToUser"("B")

ALTER TABLE "public"."TriggerCondition" ADD FOREIGN KEY ("triggerId")REFERENCES "public"."Trigger"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_TriggerToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Trigger"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_TriggerToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200612093907-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,239 @@
+datasource postgresql {
+  provider = "postgresql"
+  url      = env("DB_STRING")
+}
+
+// binaryTargets = ["debian-openssl-1.1.x"]
+generator client {
+  provider = "prisma-client-js"
+  output   = "./node_modules/@prisma/client"
+}
+
+model ColourSettings {
+  dark             String?
+  darkest          String?
+  error            String?
+  id               Int               @default(autoincrement()) @id
+  light            String?
+  lightest         String?
+  muted            String?
+  normal           String?
+  primary          String
+  primaryAlt       String?
+  secondary        String?
+  success          String?
+  tertiary         String?
+  text             String?
+  warning          String?
+  customerSettings CustomerSettings?
+}
+
+model FontSettings {
+  body             String?
+  fontTitle        String?
+  id               Int               @default(autoincrement()) @id
+  settingTitle     String?
+  special          String?
+  customerSettings CustomerSettings?
+}
+
+model CustomerSettings {
+  id               Int             @default(autoincrement()) @id
+  logoUrl          String?
+  colourSettingsId Int?
+  colourSettings   ColourSettings? @relation(fields: [colourSettingsId], references: [id])
+  fontSettingsId   Int?
+  fontSettings     FontSettings?   @relation(fields: [fontSettingsId], references: [id])
+  customerId       String?         @unique
+  customer         Customer?       @relation(fields: [customerId], references: [id])
+}
+
+model Customer {
+  id          String            @default(cuid()) @id
+  slug        String            @unique
+  name        String
+  settings    CustomerSettings?
+  dialogues   Dialogue[]
+  users       User[]
+  roles       Role[]
+  permissions Permission[]
+}
+
+model Dialogue {
+  creationDate DateTime       @default(now())
+  updatedAt    DateTime?      @updatedAt
+  description  String
+  id           String         @default(cuid()) @id
+  customerId   String
+  customer     Customer       @relation(fields: [customerId], references: [id])
+  publicTitle  String?
+  title        String
+  edges        Edge[]
+  questions    QuestionNode[]
+  sessions     Session[]
+}
+
+model QuestionNode {
+  id                         String           @default(cuid()) @id
+  creationDate               DateTime         @default(now())
+  updatedAt                  DateTime?        @updatedAt
+  isLeaf                     Boolean          @default(false)
+  isRoot                     Boolean          @default(false)
+  title                      String
+  type                       String
+  options                    QuestionOption[]
+  children                   Edge[]
+  overrideLeafId             String?
+  overrideLeaf               QuestionNode?    @relation("QNodeToOverrideLeaf", fields: [overrideLeafId], references: [id])
+  isOverrideLeafOf           QuestionNode[]   @relation("QNodeToOverrideLeaf")
+  questionDialogue           Dialogue?        @relation(fields: [questionDialogueId], references: [id])
+  questionDialogueId         String?
+  isChildNodeOf              Edge[]           @relation("Edge_childNodeToQuestionNode")
+  isParentNodeOf             Edge[]           @relation("Edge_parentNodeToQuestionNode")
+  isRelatedNodeOfNodeEntries NodeEntry[]
+  edgeId                     String?
+  Edge                       Edge?            @relation("EdgeChildrenRelation", fields: [edgeId], references: [id])
+  QuestionOption             QuestionOption[] @relation("QuestionNodeOptions")
+}
+
+model Edge {
+  childNodeId                String
+  createdAt                  DateTime            @default(now())
+  updatedAt                  DateTime            @updatedAt
+  id                         String              @default(cuid()) @id
+  parentNodeId               String
+  dialogueId                 String?
+  conditions                 QuestionCondition[]
+  isEdgeOf                   QuestionNode[]      @relation("EdgeChildrenRelation")
+  childNode                  QuestionNode        @relation("Edge_childNodeToQuestionNode", fields: [childNodeId], references: [id])
+  parentNode                 QuestionNode        @relation("Edge_parentNodeToQuestionNode", fields: [parentNodeId], references: [id])
+  dialogue                   Dialogue?           @relation(fields: [dialogueId], references: [id])
+  isRelatedNodeOfNodeEntries NodeEntry[]
+  questionNodeId             String?
+  QuestionNode               QuestionNode?       @relation(fields: [questionNodeId], references: [id])
+}
+
+model QuestionCondition {
+  conditionType String
+  id            Int     @default(autoincrement()) @id
+  matchValue    String?
+  renderMax     Int?
+  renderMin     Int?
+  edgeId        String?
+  Edge          Edge?   @relation(fields: [edgeId], references: [id])
+}
+
+model QuestionOption {
+  id             Int           @default(autoincrement()) @id
+  publicValue    String?
+  value          String
+  questionId     String?
+  question       QuestionNode? @relation("QuestionNodeOptions", fields: [questionId], references: [id])
+  questionNodeId String?
+  QuestionNode   QuestionNode? @relation(fields: [questionNodeId], references: [id])
+}
+
+model Session {
+  createdAt   DateTime    @default(now())
+  id          String      @default(cuid()) @id
+  dialogueId  String
+  dialogue    Dialogue    @relation(fields: [dialogueId], references: [id])
+  nodeEntries NodeEntry[]
+}
+
+model NodeEntry {
+  id            String           @default(cuid()) @id
+  creationDate  DateTime         @default(now())
+  depth         Int?
+  relatedEdgeId String?
+  relatedNodeId String?
+  sessionId     String?
+  session       Session?         @relation(fields: [sessionId], references: [id])
+  relatedNode   QuestionNode?    @relation(fields: [relatedNodeId], references: [id])
+  relatedEdge   Edge?            @relation(fields: [relatedEdgeId], references: [id])
+  values        NodeEntryValue[]
+}
+
+model NodeEntryValue {
+  id                     Int              @default(autoincrement()) @id
+  numberValue            Int?
+  textValue              String?
+  parentNodeEntryValueId Int?
+  parentNodeEntryValue   NodeEntryValue?  @relation("NodeEntryValueToNodeEntryValue", fields: [parentNodeEntryValueId], references: [id])
+  multiValues            NodeEntryValue[] @relation("NodeEntryValueToNodeEntryValue")
+  nodeEntryId            String?
+  NodeEntry              NodeEntry?       @relation(fields: [nodeEntryId], references: [id])
+}
+
+model Permission {
+  id                 String    @default(cuid()) @id
+  name               String
+  description        String?
+  isPermissionOfRole Role[]    @relation(references: [id])
+  Customer           Customer? @relation(fields: [customerId], references: [id])
+  customerId         String?
+}
+
+model Role {
+  id          String       @default(cuid()) @id
+  name        String
+  roleId      String?
+  permissions Permission[] @relation(references: [id])
+  User        User[]
+  Customer    Customer?    @relation(fields: [customerId], references: [id])
+  customerId  String?
+  @@unique([id, name])
+}
+
+model User {
+  id         String    @default(cuid()) @id
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime? @updatedAt
+  email      String    @unique
+  phone      String?
+  firstName  String?
+  lastName   String?
+  roleId     String
+  role       Role      @relation(fields: [roleId], references: [id])
+  Customer   Customer? @relation(fields: [customerId], references: [id])
+  customerId String?
+  triggers   Trigger[] @relation(references: [id])
+}
+
+enum TriggerType {
+  QUESTION
+  SCHEDULED
+}
+
+enum TriggerMedium {
+  EMAIL
+  PHONE
+  BOTH
+}
+
+enum TriggerConditionType {
+  LOW_THRESHOLD
+  HIGH_THRESHOLD
+  INNER_RANGE
+  OUTER_RANGE
+  TEXT_MATCH
+}
+
+model TriggerCondition {
+  id        Int                  @default(autoincrement()) @id
+  type      TriggerConditionType
+  minValue  Int?
+  maxValue  Int?
+  textValue String?
+  trigger   Trigger?             @relation(fields: [triggerId], references: [id])
+  triggerId String?
+}
+
+model Trigger {
+  id         String             @default(cuid()) @id
+  name       String
+  type       TriggerType
+  medium     TriggerMedium
+  conditions TriggerCondition[]
+  recipients User[]
+}
```


