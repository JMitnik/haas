# Migration `20200622160134-many-to-many-tag-relation-with-dialogue`

This migration has been generated by Cold-A-Muse at 6/22/2020, 4:01:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_DialogueToTag" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

ALTER TABLE "public"."Tag" DROP CONSTRAINT IF EXiSTS "Tag_dialogueId_fkey",
DROP COLUMN "dialogueId",
ADD COLUMN "customerId" text   ;

CREATE UNIQUE INDEX "_DialogueToTag_AB_unique" ON "public"."_DialogueToTag"("A","B")

CREATE  INDEX "_DialogueToTag_B_index" ON "public"."_DialogueToTag"("B")

ALTER TABLE "public"."_DialogueToTag" ADD FOREIGN KEY ("A")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_DialogueToTag" ADD FOREIGN KEY ("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200622153811-added-tag-field-to-dialogue..20200622160134-many-to-many-tag-relation-with-dialogue
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url      = env("DB_STRING")
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -57,15 +57,17 @@
   users       User[]
   roles       Role[]
   permissions Permission[]
   triggers    Trigger[]
+  tags        Tag[]
 }
 model Tag {
-  id         String    @default(cuid()) @id
+  id         String     @default(cuid()) @id
   name       String
-  dialogue   Dialogue? @relation(fields: [dialogueId], references: [id])
-  dialogueId String?
+  isTagOf    Dialogue[] @relation(references: [id])
+  customer   Customer?  @relation(fields: [customerId], references: [id])
+  customerId String?
 }
 model Dialogue {
   creationDate DateTime       @default(now())
```


