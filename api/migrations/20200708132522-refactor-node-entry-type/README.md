# Migration `20200708132522-refactor-node-entry-type`

This migration has been generated by Jonathan at 7/8/2020, 1:25:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "NodeType" AS ENUM ('GENERIC', 'SLIDER', 'CHOICE', 'REGISTRATION', 'TEXTBOX', 'LINK');

CREATE TABLE "public"."SliderNodeEntry" (
"id" SERIAL,"nodeEntryId" text  NOT NULL ,"value" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."ChoiceNodeEntry" (
"id" SERIAL,"nodeEntryId" text  NOT NULL ,"value" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."TextboxNodeEntry" (
"id" SERIAL,"nodeEntryId" text  NOT NULL ,"value" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."RegistrationNodeEntry" (
"id" SERIAL,"nodeEntryId" text  NOT NULL ,"value" jsonb   ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."NodeEntry" ADD COLUMN "type" "NodeType" NOT NULL DEFAULT E'GENERIC';

ALTER TABLE "public"."NodeEntryValue" DROP CONSTRAINT IF EXiSTS "NodeEntryValue_nodeEntryId_fkey";

ALTER TABLE "public"."NodeEntryValue" DROP CONSTRAINT IF EXiSTS "NodeEntryValue_parentNodeEntryValueId_fkey";

CREATE UNIQUE INDEX "SliderNodeEntry_nodeEntryId" ON "public"."SliderNodeEntry"("nodeEntryId")

ALTER TABLE "public"."SliderNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ChoiceNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TextboxNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."RegistrationNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."NodeEntryValue";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200707143022-customer-id---email-unique-field..20200708132522-refactor-node-entry-type
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -160,32 +160,62 @@
   dialogue    Dialogue    @relation(fields: [dialogueId], references: [id])
   nodeEntries NodeEntry[]
 }
+// Node-entry types
+
+enum NodeType {
+  GENERIC
+  SLIDER
+  CHOICE
+  REGISTRATION
+  TEXTBOX
+  LINK
+}
+
 model NodeEntry {
   id            String           @default(cuid()) @id
   creationDate  DateTime         @default(now())
+  type          NodeType         @default(value: GENERIC)
   depth         Int?
   relatedEdgeId String?
   relatedNodeId String?
   sessionId     String?
   session       Session?         @relation(fields: [sessionId], references: [id])
   relatedNode   QuestionNode?    @relation(fields: [relatedNodeId], references: [id])
   relatedEdge   Edge?            @relation(fields: [relatedEdgeId], references: [id])
-  values        NodeEntryValue[]
+  
+  sliderNodeEntry SliderNodeEntry?
 }
-model NodeEntryValue {
-  id                     Int              @default(autoincrement()) @id
-  numberValue            Int?
-  textValue              String?
-  parentNodeEntryValueId Int?
-  parentNodeEntryValue   NodeEntryValue?  @relation("NodeEntryValueToNodeEntryValue", fields: [parentNodeEntryValueId], references: [id])
-  multiValues            NodeEntryValue[] @relation("NodeEntryValueToNodeEntryValue")
-  nodeEntryId            String?
-  NodeEntry              NodeEntry?       @relation(fields: [nodeEntryId], references: [id])
+model SliderNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value Int?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
+model ChoiceNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value String?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model TextboxNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value String?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
+model RegistrationNodeEntry {
+  id  Int  @default(autoincrement()) @id
+  value Json?
+  nodeEntryId String
+  nodeEntry NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
 model Permission {
   id                 String    @default(cuid()) @id
   name               String
   description        String?
```


