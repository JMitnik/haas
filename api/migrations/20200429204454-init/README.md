# Migration `20200429204454-init`

This migration has been generated by Cold-A-Muse at 4/29/2020, 8:44:54 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."ColourSettings" (
    "dark" text   ,
    "darkest" text   ,
    "error" text   ,
    "id" SERIAL,
    "light" text   ,
    "lightest" text   ,
    "muted" text   ,
    "normal" text   ,
    "primary" text  NOT NULL ,
    "primaryAlt" text   ,
    "secondary" text   ,
    "success" text   ,
    "tertiary" text   ,
    "text" text   ,
    "warning" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."FontSettings" (
    "body" text   ,
    "fontTitle" text   ,
    "id" SERIAL,
    "settingTitle" text   ,
    "special" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."CustomerSettings" (
    "colourSettingsId" integer   ,
    "customerId" text   ,
    "fontSettingsId" integer   ,
    "id" SERIAL,
    "logoUrl" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Customer" (
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Dialogue" (
    "creationDate" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "customerId" text  NOT NULL ,
    "description" text  NOT NULL ,
    "id" text  NOT NULL ,
    "publicTitle" text   ,
    "title" text  NOT NULL ,
    "updatedAt" timestamp(3)   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."QuestionNode" (
    "creationDate" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "edgeId" text   ,
    "id" text  NOT NULL ,
    "isLeaf" boolean  NOT NULL DEFAULT false,
    "isRoot" boolean  NOT NULL DEFAULT false,
    "overrideLeafId" text   ,
    "questionDialogueId" text   ,
    "title" text  NOT NULL ,
    "type" text  NOT NULL ,
    "updatedAt" timestamp(3)   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Edge" (
    "childNodeId" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "dialogueId" text   ,
    "id" text  NOT NULL ,
    "parentNodeId" text  NOT NULL ,
    "questionNodeId" text   ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."QuestionCondition" (
    "conditionType" text  NOT NULL ,
    "edgeId" text   ,
    "id" SERIAL,
    "matchValue" text   ,
    "renderMax" integer   ,
    "renderMin" integer   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."QuestionOption" (
    "id" SERIAL,
    "publicValue" text   ,
    "questionId" text   ,
    "questionNodeId" text   ,
    "value" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Session" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "dialogueId" text  NOT NULL ,
    "id" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."NodeEntry" (
    "creationDate" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "depth" integer   ,
    "id" text  NOT NULL ,
    "relatedEdgeId" text   ,
    "relatedNodeId" text   ,
    "sessionId" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."NodeEntryValue" (
    "id" SERIAL,
    "nodeEntryId" text   ,
    "numberValue" integer   ,
    "parentNodeEntryValueId" integer   ,
    "textValue" text   ,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "CustomerSettings.customerId" ON "public"."CustomerSettings"("customerId")

CREATE UNIQUE INDEX "CustomerSettings_colourSettingsId" ON "public"."CustomerSettings"("colourSettingsId")

CREATE UNIQUE INDEX "CustomerSettings_fontSettingsId" ON "public"."CustomerSettings"("fontSettingsId")

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("colourSettingsId")REFERENCES "public"."ColourSettings"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("fontSettingsId")REFERENCES "public"."FontSettings"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."CustomerSettings" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Dialogue" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("overrideLeafId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("questionDialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("edgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("childNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("parentNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Edge" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."QuestionCondition" ADD FOREIGN KEY ("edgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("questionId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."QuestionOption" ADD FOREIGN KEY ("questionNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("dialogueId")REFERENCES "public"."Dialogue"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("sessionId")REFERENCES "public"."Session"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("relatedNodeId")REFERENCES "public"."QuestionNode"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntry" ADD FOREIGN KEY ("relatedEdgeId")REFERENCES "public"."Edge"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntryValue" ADD FOREIGN KEY ("parentNodeEntryValueId")REFERENCES "public"."NodeEntryValue"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."NodeEntryValue" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200429204454-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,153 @@
+datasource postgresql {
+  provider = "postgresql"
+  url      = env("DB_STRING")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model ColourSettings {
+  dark             String?
+  darkest          String?
+  error            String?
+  id               Int               @default(autoincrement()) @id
+  light            String?
+  lightest         String?
+  muted            String?
+  normal           String?
+  primary          String
+  primaryAlt       String?
+  secondary        String?
+  success          String?
+  tertiary         String?
+  text             String?
+  warning          String?
+  customerSettings CustomerSettings?
+}
+
+model FontSettings {
+  body             String?
+  fontTitle        String?
+  id               Int               @default(autoincrement()) @id
+  settingTitle     String?
+  special          String?
+  customerSettings CustomerSettings?
+}
+
+model CustomerSettings {
+  id               Int             @default(autoincrement()) @id
+  logoUrl          String?
+  colourSettingsId Int?
+  colourSettings   ColourSettings? @relation(fields: [colourSettingsId], references: [id])
+  fontSettingsId   Int?
+  fontSettings     FontSettings?   @relation(fields: [fontSettingsId], references: [id])
+  customerId       String?         @unique
+  customer         Customer?       @relation(fields: [customerId], references: [id])
+}
+
+model Customer {
+  id        String            @default(cuid()) @id
+  name      String
+  settings  CustomerSettings?
+  dialogues Dialogue[]
+}
+
+model Dialogue {
+  creationDate DateTime       @default(now())
+  updatedAt    DateTime?      @updatedAt
+  description  String
+  id           String         @default(cuid()) @id
+  customerId   String
+  customer     Customer       @relation(fields: [customerId], references: [id])
+  publicTitle  String?
+  title        String
+  edges        Edge[]
+  questions    QuestionNode[]
+}
+
+model QuestionNode {
+  id                         String           @default(cuid()) @id
+  creationDate               DateTime         @default(now())
+  updatedAt                  DateTime?        @updatedAt
+  isLeaf                     Boolean          @default(false)
+  isRoot                     Boolean          @default(false)
+  title                      String
+  type                       String
+  options                    QuestionOption[]
+  children                   Edge[]
+  overrideLeafId             String?
+  overrideLeaf               QuestionNode?    @relation("QNodeToOverrideLeaf", fields: [overrideLeafId], references: [id])
+  isOverrideLeafOf           QuestionNode[]   @relation("QNodeToOverrideLeaf")
+  questionDialogue           Dialogue?        @relation(fields: [questionDialogueId], references: [id])
+  questionDialogueId         String?
+  isChildNodeOf              Edge[]           @relation("Edge_childNodeToQuestionNode")
+  isParentNodeOf             Edge[]           @relation("Edge_parentNodeToQuestionNode")
+  isRelatedNodeOfNodeEntries NodeEntry[]
+  edgeId                     String?
+}
+
+model Edge {
+  childNodeId                String
+  createdAt                  DateTime            @default(now())
+  updatedAt                  DateTime            @updatedAt
+  id                         String              @default(cuid()) @id
+  parentNodeId               String
+  dialogueId                 String?
+  conditions                 QuestionCondition[]
+  isEdgeOf                   QuestionNode[]      @relation("EdgeChildrenRelation")
+  childNode                  QuestionNode        @relation("Edge_childNodeToQuestionNode", fields: [childNodeId], references: [id])
+  parentNode                 QuestionNode        @relation("Edge_parentNodeToQuestionNode", fields: [parentNodeId], references: [id])
+  dialogue                   Dialogue?           @relation(fields: [dialogueId], references: [id])
+  isRelatedNodeOfNodeEntries NodeEntry[]
+  questionNodeId             String?
+}
+
+model QuestionCondition {
+  conditionType String
+  id            Int     @default(autoincrement()) @id
+  matchValue    String?
+  renderMax     Int?
+  renderMin     Int?
+  edgeId        String?
+}
+
+model QuestionOption {
+  id             Int           @default(autoincrement()) @id
+  publicValue    String?
+  value          String
+  questionId     String?
+  question       QuestionNode? @relation("QuestionNodeOptions", fields: [questionId], references: [id])
+  questionNodeId String?
+}
+
+model Session {
+  createdAt   DateTime    @default(now())
+  id          String      @default(cuid()) @id
+  dialogueId  String
+  dialogue    Dialogue    @relation("DialogueToSessions", fields: [dialogueId], references: [id])
+  nodeEntries NodeEntry[]
+}
+
+model NodeEntry {
+  id            String           @default(cuid()) @id
+  creationDate  DateTime         @default(now())
+  depth         Int?
+  relatedEdgeId String?
+  relatedNodeId String?
+  sessionId     String?
+  session       Session?         @relation(fields: [sessionId], references: [id])
+  relatedNode   QuestionNode?    @relation(fields: [relatedNodeId], references: [id])
+  relatedEdge   Edge?            @relation(fields: [relatedEdgeId], references: [id])
+  values        NodeEntryValue[]
+}
+
+model NodeEntryValue {
+  id                     Int              @default(autoincrement()) @id
+  numberValue            Int?
+  textValue              String?
+  parentNodeEntryValueId Int?
+  parentNodeEntryValue   NodeEntryValue?  @relation("NodeEntryValueToNodeEntryValue", fields: [parentNodeEntryValueId], references: [id])
+  multiValues            NodeEntryValue[] @relation("NodeEntryValueToNodeEntryValue")
+  nodeEntryId            String?
+}
```


