# Migration `20210115090822-added-extra-fields-to-create-workspace-job`

This migration has been generated by Cold-A-Muse at 1/15/2021, 4:08:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."CreateWorkspaceJob" ADD COLUMN "createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN "updatedAt" timestamp(3)   ,
ADD COLUMN "name" text   
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210113080622-new-job-status..20210115090822-added-extra-fields-to-create-workspace-job
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -49,18 +49,20 @@
   customer         Customer?       @relation(fields: [customerId], references: [id])
 }
 model Customer {
-  id          String            @id @default(cuid())
-  slug        String            @unique
-  name        String
-  settings    CustomerSettings?
-  dialogues   Dialogue[]
-  users       UserOfCustomer[]
-  roles       Role[]
-  permissions Permission[]
-  triggers    Trigger[]
-  tags        Tag[]
+  id              String            @id @default(cuid())
+  slug            String            @unique
+  name            String
+  settings        CustomerSettings?
+  dialogues       Dialogue[]
+  users           UserOfCustomer[]
+  roles           Role[]
+  permissions     Permission[]
+  triggers        Trigger[]
+  tags            Tag[]
+  campaigns       Campaign[]
+  CampaignVariant CampaignVariant[]
 }
 enum TagEnum {
   DEFAULT
@@ -95,8 +97,9 @@
   isWithoutGenData Boolean        @default(value: false)
   wasGeneratedWithGenData Boolean @default(value: false)
   @@unique([slug, customerId])
+  CampaignVariant CampaignVariant[]
 }
 enum NodeType {
   GENERIC
@@ -395,8 +398,12 @@
   CAN_CREATE_TRIGGERS
   CAN_DELETE_TRIGGERS
   CAN_DELETE_WORKSPACE
   CAN_EDIT_WORKSPACE
+  // Campaign oriented
+  CAN_VIEW_CAMPAIGNS
+  CAN_CREATE_CAMPAIGNS
+  CAN_CREATE_DELIVERIES
 }
 enum RoleTypeEnum {
   ADMIN
@@ -538,19 +545,111 @@
   PRE_PROCESSING
   PRE_PROCESSING_LOGO
   PRE_PROCESSING_WEBSITE_SCREENSHOT
   READY_FOR_PROCESSING
-  IN_PHOTOSHOP_QUEUE 
+  IN_PHOTOSHOP_QUEUE
   PHOTOSHOP_PROCESSING
   PENDING
   COMPLETED
   FAILED
 }
 model CreateWorkspaceJob {
   id            String             @id @default(cuid())
+  createdAt     DateTime?          @default(now())
+  updatedAt     DateTime?          @updatedAt
+  name          String?
   referenceId   String?
   referenceType CloudReferenceType
   status        JobStatusType      @default(PENDING)
   resourcesUrl  String?
   Job           Job
 }
+
+// Campaigns
+enum CampaignVariantTypeEnum {
+  EMAIL
+  SMS
+  QUEUE
+}
+
+model Campaign {
+  id            String                      @id @default(cuid())
+  label         String
+  deliveries    Delivery[]
+  variantsEdges CampaignVariantToCampaign[]
+
+  workspaceId String
+  workspace   Customer @relation(fields: [workspaceId], references: [id])
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model CampaignVariantToCampaign {
+  campaignId String
+  campaign   Campaign @relation(fields: [campaignId], references: [id])
+
+  campaignVariantId String
+  campaignVariant   CampaignVariant @relation(fields: [campaignVariantId], references: [id])
+
+  // Weight decides in A/B testing which
+  weight Int
+
+  @@id([campaignId, campaignVariantId])
+}
+
+model CampaignVariant {
+  id    String @id @default(cuid())
+  label String
+  body  String
+
+  workspace Customer @relation(fields: [customerId], references: [id])
+  dialogue  Dialogue @relation(fields: [dialogueId], references: [id])
+
+  subject                   String?
+  type                      CampaignVariantTypeEnum
+  CampaignVariantToCampaign CampaignVariantToCampaign[]
+  Delivery                  Delivery[]
+  customerId                String
+  dialogueId                String
+}
+
+enum DeliveryStatusTypeEnum {
+  SCHEDULED
+  DEPLOYED
+  SENT
+  OPENED
+  FINISHED
+}
+
+model Delivery {
+  // We generated the ID ourselves
+  id String @id
+
+  deliveryRecipientFirstName String?
+  deliveryRecipientLastName  String?
+  deliveryRecipientEmail     String?
+  deliveryRecipientPhone     String?
+
+  campaignId String
+  campaign   Campaign @relation(fields: [campaignId], references: [id])
+
+  campaignVariantId String
+  campaignVariant   CampaignVariant @relation(fields: [campaignVariantId], references: [id])
+
+  currentStatus DeliveryStatusTypeEnum
+
+  events DeliveryEvents[]
+
+  scheduledAt DateTime
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime? @updatedAt
+}
+
+model DeliveryEvents {
+  id         String                 @id @default(cuid())
+  status     DeliveryStatusTypeEnum
+  createdAt  DateTime               @default(now())
+  deliveryId String
+  Delivery   Delivery              @relation(fields: [deliveryId], references: [id])
+}
```


