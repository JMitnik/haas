# Migration `20201118221718-added-form-node`

This migration has been generated by Jonathan at 11/18/2020, 11:17:18 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."FormNodeFieldType" AS ENUM ('email', 'phoneNumber', 'url', 'shortText', 'longText', 'number')

ALTER TYPE "NodeType" ADD VALUE 'FORM'

ALTER TABLE "public"."QuestionNode" ADD COLUMN "formNodeId" text   

CREATE TABLE "public"."FormNodeField" (
"id" text   NOT NULL ,
"label" text   NOT NULL ,
"type" "FormNodeFieldType"  NOT NULL DEFAULT E'shortText',
"isRequired" boolean   NOT NULL DEFAULT false,
"position" integer   NOT NULL ,
"formNodeId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNode" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeEntryData" (
"id" SERIAL,
"email" text   ,
"phoneNumber" text   ,
"url" text   ,
"shortText" text   ,
"longText" text   ,
"number" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FormNodeEntry" (
"id" SERIAL,
"nodeEntryId" text   NOT NULL ,
"formNodeEntryDataId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "FormNodeEntry_nodeEntryId_unique" ON "public"."FormNodeEntry"("nodeEntryId")

ALTER TABLE "public"."FormNodeField" ADD FOREIGN KEY ("formNodeId")REFERENCES "public"."FormNode"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeEntry" ADD FOREIGN KEY ("formNodeEntryDataId")REFERENCES "public"."FormNodeEntryData"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FormNodeEntry" ADD FOREIGN KEY ("nodeEntryId")REFERENCES "public"."NodeEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."QuestionNode" ADD FOREIGN KEY ("formNodeId")REFERENCES "public"."FormNode"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201110034050-restart..20201118221718-added-form-node
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // binaryTargets = ["debian-openssl-1.1.x"]
 generator client {
@@ -102,13 +102,57 @@
   GENERIC
   SLIDER
   CHOICE
   REGISTRATION
+  FORM
   TEXTBOX
   LINK
   SHARE
 }
+// NodeType: Form
+enum FormNodeFieldType {
+  email
+  phoneNumber
+  url
+  shortText
+  longText
+  number
+}
+
+model FormNodeField {
+  id    String        @id @default(cuid())
+  label String
+  type  FormNodeFieldType @default(shortText)
+  isRequired  Boolean @default(false)
+  position  Int
+}
+
+model FormNode {
+  id           String           @id @default(cuid())
+  createdAt     DateTime        @default(now())
+  fields        FormNodeField[]
+}
+
+model FormNodeEntryData {
+  id          Int       @id @default(autoincrement())
+  email       String?
+  phoneNumber String?
+  url         String?
+  shortText   String?
+  longText    String?
+  number      String?
+}
+
+model FormNodeEntry {
+  id          Int       @id @default(autoincrement())
+  value       FormNodeEntryData
+
+  // Relation to node
+  nodeEntryId String
+  nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
+}
+
 model QuestionNode {
   id           String           @id @default(cuid())
   creationDate DateTime         @default(now())
   updatedAt    DateTime         @updatedAt
@@ -135,12 +179,14 @@
   QuestionOption QuestionOption[] @relation("QuestionNodeOptions")
   triggers       Trigger[]
-  share Share?
-
   links             Link[]
   QuestionOfTrigger QuestionOfTrigger[]
+  
+  // Different nodeType properties
+  share Share?
+  form  FormNode?
 }
 enum LinkTypeEnum {
   SOCIAL
@@ -244,9 +290,13 @@
   // Entry types
   sliderNodeEntry       SliderNodeEntry?
   choiceNodeEntry       ChoiceNodeEntry?
   textboxNodeEntry      TextboxNodeEntry?
+  
+  // @Deprecated => FormNodeEntry
   registrationNodeEntry RegistrationNodeEntry?
+  
+  formNodeEntry FormNodeEntry?
   linkNodeEntry         LinkNodeEntry?
 }
 model LinkNodeEntry {
@@ -276,8 +326,9 @@
   nodeEntryId String
   nodeEntry   NodeEntry @relation(references: [id], fields: [nodeEntryId])
 }
+// @DEPRECATED
 model RegistrationNodeEntry {
   id          Int       @id @default(autoincrement())
   value       Json?
   nodeEntryId String
```


